{
    "name": "APT27.yar",
    "rule": "rule DllHijacker01 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Hunt for VSNTAR21 / DllHijacker01 IronTiger / LuckyMouse / APT27 malware\"\n        cape_type = \"DllHijacker01 Payload\"\n    strings:\n        $s1 = \"libvlc_add_intf\" fullword ascii\n        $s2 = \"libvlc_dllonexit\" fullword ascii\n        $s3 = \"libvlc_getmainargs\" fullword ascii\n        $s4 = \"libvlc_initenv\" fullword ascii\n        $s5 = \"libvlc_set_app_id\" fullword ascii\n        $s6 = \"libvlc_set_app_type\" fullword ascii\n        $s7 = \"libvlc_set_user_agent\" fullword ascii\n        $s8 = \"libvlc_wait\" fullword ascii\n        $s9 = \"dll.dll\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 6 of them\n}\n\nrule HyperBro02 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects HyperBro IronTiger / LuckyMouse / APT27 malware\"\n        cape_type = \"HyperBro Payload\"\n    strings:\n        $s1 = \"\\\\cmd.exe /A\" fullword wide\n        $s2 = \"C:\\\\windows\\\\explorer.exe\" fullword wide\n        $s3 = \"\\\\\\\\.\\\\pipe\\\\testpipe\" fullword wide\n        $s4 = \"Elevation:Administrator!new:{\" wide\n        $s5 = \"log.log\" fullword wide\n        $s6 = \"%s\\\\%d.exe\" fullword wide\n        $s7 = \".?AVTPipeProtocol@@\" fullword ascii\n        $s8 = \".?AVTCaptureMgr@@\" fullword ascii\n        $s9 = \"system-%d\" fullword wide\n        $s10 = \"[test] %02d:%02d:%02d:%03d %s\" fullword wide\n        $s11 = \"\\\\..\\\\data.dat\" fullword wide\n        $s12 = \"\\\\..\\\\config.ini\" fullword wide\n        $s13 = { 73 00 76 00 63 00 68 00 6f 00 73 00 74 00 2e 00 65 00 78 00 65 00 00 00 20 00 2d 00 77 00 6f 00 72 00 6b 00 65 00 72 00 }\n        $s14 = { 73 00 76 00 63 00 68 00 6f 00 73 00 74 00 2e 00 65 00 78 00 65 00 00 00 20 00 2d 00 64 00 61 00 65 00 6d 00 6f 00 6e 00 }\n        $cnc1 = \"https://%s:%d/ajax\" fullword wide\n        $cnc2 = \"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.116 Safari/537.36\" fullword wide\n        $cnc3 = \"139.180.208.225\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and (7 of ($s*) or (2 of ($cnc*) and 2 of ($s*)))\n}\n\n/*\nToo many FPs\nrule HyperBro03 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Hunt HyperBro IronTiger / LuckyMouse / APT27 malware\"\n        cape_type = \"HyperBro Payload\"\n    strings:\n        //$h1 = \"HControl\" ascii wide\n        //$h2 = \"HSleep\" ascii wide\n        //$h3 = \"HTrans\" ascii wide\n        $i1 = \"IAgent\" ascii wide\n        $i2 = \"ITcpAgent\" ascii wide\n        $i3 = \"IAgentListener\" ascii wide\n        $t1 = \"TCommon\" ascii\n        $t2 = \"TFileInfo\" ascii\n        $t3 = \"TFileRename\" ascii\n        $t4 = \"TFileUpload\" ascii\n        $t5 = \"TServicesInfo\" ascii\n        $t6 = \"TListUser\" ascii\n        $t7 = \"TTransmit\" ascii\n        $vc1 = \"CSSLAgent\" ascii wide\n        $vc2 = \"CSocks5\" ascii wide\n        $vc3 = \"CTcpAgent\" ascii wide\n        $cm1 = \"CMCapture\" ascii wide\n        $cm2 = \"CMFile\" ascii wide\n        $cm3 = \"CMPipeClient\" ascii wide\n        $cm4 = \"CMPipeServer\" ascii wide\n        $cm5 = \"CMProcess\" ascii wide\n        $cm6 = \"CMServices\" ascii wide\n        $cm7 = \"CMShell\" ascii wide\n    condition:\n        // Reduce potential FPs\n        uint16(0) == 0x5a4d and (all of ($i*) or 6 of ($t*) or 6 of ($cm*) or all of ($vc*))\n        //uint16(0) == 0x5a4d and (all of ($h*) or all of ($i*) or 6 of ($t*) or 6 of ($cm*) or all of ($vc*))\n}\n*/\n\nrule DllHijacker02 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects ServiceCrt / DllHijacker03 IronTiger / LuckyMouse / APT27 malware\"\n        cape_type = \"DllHijacker02 Payload\"\n    strings:\n        $s1 = \"ServiceCrtMain\" fullword ascii\n        $s2 = \"mpsvc.dll\" fullword ascii\n        $o1 = { 84 db 0f 85 4c ff ff ff e8 14 06 00 00 8b f0 83 }\n        $o2 = { f7 c1 00 ff ff ff 75 c5 eb 13 0f ba 25 10 20 01 }\n        $o3 = { 8d 04 b1 8b d9 89 45 fc 8d 34 b9 a1 18 20 01 10 }\n        $o4 = { b0 01 c3 68 b8 2c 01 10 e8 83 ff ff ff c7 04 24 }\n        $o5 = { eb 34 66 0f 12 0d 00 fe 00 10 f2 0f 59 c1 ba cc }\n        $o6 = { 73 c7 dc 0d 4c ff 00 10 eb bf dd 05 34 ff 00 10 }\n    condition:\n        uint16(0) == 0x5a4d and all of ($s*) and 5 of ($o*)\n}\n",
    "uploadedBy": "f0b33c9c-0019-4046-984b-f6f3d95dea61",
    "category": "yar",
    "uploadedAt": "2025-05-07T09:54:43.687Z",
    "status": "active"
}