{
    "name": "Duke.yar",
    "rule": "import \"pe\"\n\nrule FatDuke {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects FatDuke\"\n        cape_type = \"FatDuke Payload\"\n    strings:\n        $s1 = \"\\\\\\\\?\\\\Volume\" fullword ascii\n        $s2 = \"WINHTTP_AUTOPROXY_OPTIONS@@PAUWINHTTP_PROXY_INFO@@\" ascii\n        $s3 = \"WINHTTP_CURRENT_USER_IE_PROXY_CONFIG@@\" ascii\n        $s4 = \"Cannot write a Cannot find the too long string mber of records Log malfunction! Cannot create ain an invalid ra Internal sync iright function iWaitForSingleObjffsets\" ascii\n        $pattern = \"()$^.*+?[]|\\\\-{},:=!\" ascii\n        $b64 = \"eyJjb25maWdfaWQiOi\" wide\n        //$decoded = \"{\\\"config_id\\\"\" base64wide\n    condition:\n        //uint16(0) == 0x5a4d and (3 of ($s*) or (($b64 or $decoded) and 2 of them) or (#pattern > 3 and 2 of them))\n        uint16(0) == 0x5a4d and (3 of ($s*) or ($b64 and 2 of them) or (#pattern > 3 and 2 of them))\n}\n\nrule MiniDuke {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects MiniDuke\"\n        cape_type = \"MiniDuke Payload\"\n    strings:\n        $s1 = \"DefPipe\" fullword ascii\n        $s2 = \"term %5d\" fullword ascii\n        $s3 = \"pid %5d\" fullword ascii\n        $s4 = \"uptime %5d.%02dh\" fullword ascii\n        $s5 = \"login: %s\\\\%s\" fullword ascii\n        $s6 = \"Software\\\\Microsoft\\\\ApplicationManager\" ascii\n        $s7 = { 69 64 6c 65 ?? 00 73 74 6f 70 ?? 00 61 63 63 65 70 74 ?? 00 63 6f 6e 6e 65 63 74 ?? 00 6c 69 73 74 65 6e ?? 00 }\n\n        $net1 = \"salesappliances.com\" ascii\n        $net2 = \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36\" fullword ascii\n        $net3 = \"http://10.\" ascii\n        $net4 = \"JiM9t8g7j8KoJkLJlKqka8dbo7q5z4v5u3o4z\" ascii\n        $net5 = \"application/octet-stream\" ascii\n        $net6 = \"Content-Disposition: form-data; name=\\\"%s\\\"; filename=\\\"%s\\\"\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (5 of ($s*) or 4 of ($net*) or 7 of them)\n}\n\nrule PolyglotDuke {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects PolyGlotDuke\"\n        cape_type = \"PolyGlotDuke Payload\"\n    strings:\n        $s1 = { 48 b9 ff ff ff ff ff ff ff ff 51 48 23 8c 24 ?? 00 00 00 48 89 8C 24 00 00 00 00 }\n        $s2 = { 56 be ff ff ff ff 56 81 e6 7f }\n        $s3 = { 48 8b 05 19 ?4 4b 00 48 05 48 83 00 00 4c 8b 44 24 50 8b 54 24 48 48 8b }\n        //$s4 = { 48 8B 84 24 ?? 00 00 00 48 ?? ?? 24 ?? 00 00 00 48 89 84 24 }\n    condition:\n        uint16(0) == 0x5a4d and (all of ($s*)) or\n         (\n                 2 of them and\n                 pe.exports(\"InitSvc\")\n        )\n}\n",
    "uploadedBy": "f0b33c9c-0019-4046-984b-f6f3d95dea61",
    "category": "yar",
    "uploadedAt": "2025-05-07T09:54:43.738Z",
    "status": "active"
}