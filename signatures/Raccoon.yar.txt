{
    "name": "Raccoon.yar",
    "rule": "rule Raccoon {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Raccoon stealer payload\"\n        cape_type = \"Raccoon Payload\"\n    strings:\n        $s1 = \"inetcomm server passwords\" fullword wide\n        $s2 = \"content-disposition: form-data; name=\\\"file\\\"; filename=\\\"data.zip\\\"\" fullword ascii\n        $s3 = \".?AVfilesystem_error@v1@filesystem@experimental@std@@\" fullword ascii\n        $s4 = \"CredEnumerateW\" fullword ascii\n        $s5 = \"%[^:]://%[^/]%[^\" fullword ascii\n        $s6 = \"%99[^:]://%99[^/]%99[^\" fullword ascii\n        $s7 = \"Login Data\" wide\n        $s8 = \"m_it.object_iterator != m_object->m_value.object->end()\" fullword wide\n        $x1 = \"endptr == token_buffer.data() + token_buffer.size()\" fullword wide\n        $x2 = \"\\\\json.hpp\" wide\n        $x3 = \"Microsoft_WinInet_\" fullword wide\n        $x4 = \"Microsoft_WinInet_*\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and ((3 of ($x*) and 2 of ($s*)) or (4 of ($s*) and 1 of ($x*)))\n}\n\nrule RaccoonV2: raccoon_stealer_v2\n{\n    meta:\n\tauthor = \"muzi\"\n\tdate = \"2022-07-22\"\n        description = \"Detects Raccoon Stealer V2 (unpacked)\"\n        hash = \"022432f770bf0e7c5260100fcde2ec7c49f68716751fd7d8b9e113bf06167e03\"\n        cape_type = \"Raccoon Payload\"\n\n    strings:\n \n       // Simple Strings\n        $s1 = \"Profile %d\" wide\n        $s2 = \"Login Data\" wide\n        $s3 = \"0Network\\\\Cookies\" wide\n        $s4 = \"Web Data\" wide\n        $s5 = \"*.lnk\" wide\n        $s6 = \"\\\\ffcookies.txt\" wide\n        $s7 = \"\t%s %s\" wide\n        $s8 = \"wallet.dat\" wide\n        $s9 = \"S-1-5-18\" ascii wide // malware checks if running as system\n\n        /*\n\n                             LAB_0040878a                                    XREF[1]:     004087be(j)\n        0040878a 8b c3           MOV        EAX,EBX\n        0040878c 8b 0c 9f        MOV        this,dword ptr [EDI + EBX*0x4]\n        0040878f 99              CDQ\n        00408790 f7 7d fc        IDIV       dword ptr [EBP + local_8]\n        00408793 8b 45 10        MOV        EAX,dword ptr [EBP + param_3]\n        00408796 0f be 04 02     MOVSX      EAX,byte ptr [EDX + EAX*0x1]\n        0040879a 03 c1           ADD        EAX,this\n        0040879c 03 f0           ADD        ESI,EAX\n        0040879e 81 e6 ff        AND        ESI,0x800000ff\n                 00 00 80\n        004087a4 79 08           JNS        LAB_004087ae\n        004087a6 4e              DEC        ESI\n        004087a7 81 ce 00        OR         ESI,0xffffff00\n                 ff ff ff\n        004087ad 46              INC        ESI\n        */\n\n        // Decryption Routine\n        $decryption_routine = {\n                                    8B (C0|C1|C2|C3|C5|C6|C7) [0-8]\n                                    8B ?? ?? [0-8]\n                                    99 [0-8]\n                                    F7 7D ?? [0-8]\n                                    8B (45|4D|55|5D|6D|75|7D) ?? [0-8]\n                                    0F BE ?? ?? [0-8]\n                                    03 (C1|C2|C3|C5|C6|C7) [0-8]\n                                    03 (F0|F1|F2|F3|F5|F6|F7) [0-8]\n                                    81 E6 ?? ?? ?? ?? [0-8]\n                                    7? ?? [0-8]\n                                    4E [0-8]\n                                    81 CE ?? ?? ?? ?? [0-8]\n                                    46\n        }\n\n        /*\n        00408130 8b 35 14        MOV        ESI,dword ptr [DAT_0040e014]\n                 e0 40 00\n        00408136 57              PUSH       EDI\n        00408137 50              PUSH       EAX\n        00408138 ff 75 18        PUSH       dword ptr [EBP + param_7]\n        0040813b ff d1           CALL       param_1\n        0040813d 8b 7d d0        MOV        EDI,dword ptr [EBP + local_34]\n        00408140 50              PUSH       EAX\n        00408141 ff 75 18        PUSH       dword ptr [EBP + param_7]\n        00408144 57              PUSH       EDI\n        00408145 ff d6           CALL       ESI\n        00408147 85 c0           TEST       EAX,EAX\n        00408149 74 24           JZ         LAB_0040816f\n        0040814b be 50 c3        MOV        ESI,0xc350\n                 00 00\n        00408150 eb 0b           JMP        LAB_0040815d\n                             LAB_00408152                                    XREF[1]:     0040816d(j)\n        00408152 8b 45 e4        MOV        EAX,dword ptr [EBP + local_20]\n        00408155 85 c0           TEST       EAX,EAX\n        00408157 74 16           JZ         LAB_0040816f\n        00408159 c6 04 18 00     MOV        byte ptr [EAX + EBX*0x1],0x0\n                             LAB_0040815d                                    XREF[1]:     00408150(j)\n        0040815d a1 fc e0        MOV        EAX,[DAT_0040e0fc]\n                 40 00\n        00408162 8d 4d e4        LEA        param_1=>local_20,[EBP + -0x1c]\n        00408165 51              PUSH       param_1\n        00408166 56              PUSH       ESI\n        00408167 53              PUSH       EBX\n        00408168 57              PUSH       EDI\n        00408169 ff d0           CALL       EAX\n        0040816b 85 c0           TEST       EAX,EAX\n        0040816d 75 e3           JNZ        LAB_00408152\n\n        */\n\n        // C2 Comms\n        $c2_comms = {\n                      8B 35 ?? ?? ?? ?? [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      FF 75 ?? [0-8]\n                      FF (D0|D1|D2|D3|D5|D6|D7) [0-8]\n                      8B (45|4D|55|5D|6D|75|7D) ?? [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      FF 75 ?? [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      FF (D0|D1|D2|D3|D5|D6|D7) [0-8]\n                      85 C0 [0-8]\n                      (E2|EB|72|74|75|7C) ?? [0-8]\n                      (B8|B9|BA|BB|BD|BE|BF) ?? ?? ?? ?? [0-8]\n                      (E2|EB|72|74|75|7C) ?? [0-8]\n                      8B (45|4D|55|5D|6D|75|7D) ?? [0-8]\n                      85 C0 [0-8]\n                      (E2|EB|72|74|75|7C) ?? [0-8]\n                      C6 ?? ?? ?? [0-8]\n                      A1 ?? ?? ?? ?? [0-8]\n                      8D 4D ?? [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      (50|51|52|53|55|56|57) [0-8]\n                      FF ?? [0-8]\n                      85 C0 [0-8]\n                      (E2|EB|72|74|75|7C)\n        }\n\n\n    condition:\n        6 of ($s*) or\n        ($c2_comms and $decryption_routine)\n}\n\nrule Raccoon_RecordBreaker {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Raccoon Stealer 2.0, also referred to as RecordBreaker\"\n        cape_type = \"Raccoon Payload\"\n    strings:\n        $f1 = \"sgnl_\" fullword ascii\n        $f2 = \"tlgrm_\" fullword ascii\n        $f3 = \"ews_\" fullword ascii\n        $f4 = \"grbr_\" fullword ascii\n        $f5 = \"dscrd_\" fullword ascii\n        $f6 = \"wlts_\" fullword ascii\n        $f7 = \"scrnsht_\" fullword ascii\n        $f8 = \"sstmnfo_\" fullword ascii\n        $s1 = \"machineId=\" fullword ascii\n        $s2 = \"&configId=\" fullword ascii\n        $s3 = \"URL:%s\" fullword ascii\n        $s4 = \"USR:%s\" fullword ascii\n        $s5 = \"PASS:%s\" fullword ascii\n        $s6 = \"Content-Type: application/x-object\" fullword ascii\n    condition:\n        (uint16(0) == 0x5a4d and (4 of ($f*) or all of ($s*) or 7 of them)) or (11 of them)\n}\n",
    "uploadedBy": "f0b33c9c-0019-4046-984b-f6f3d95dea61",
    "category": "yar",
    "uploadedAt": "2025-05-07T09:54:43.723Z",
    "status": "active"
}