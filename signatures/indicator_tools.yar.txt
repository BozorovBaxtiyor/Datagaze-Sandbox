{
    "name": "indicator_tools.yar",
    "rule": "import \"pe\"\n\nrule INDICATOR_TOOL_PWS_LaZagne {\n    meta:\n        description = \"Detects LaZagne post-exploitation password stealing tool. It is typically embedded with malware in the binary resources.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"blaZagne.exe.manifest\" fullword ascii\n        $S2 = \"opyi-windows-manifest-filename laZagne.exe.manifest\" fullword ascii\n        $s3 = \"lazagne.softwares.windows.\" ascii\n        $s4 = \"lazagne.softwares.sysadmin.\" ascii\n        $s5 = \"lazagne.softwares.php.\" ascii\n        $s6 = \"lazagne.softwares.memory.\" ascii\n        $s7 = \"lazagne.softwares.databases.\" ascii\n        $s8 = \"lazagne.softwares.browsers.\" ascii\n        $s9 = \"lazagne.config.write_output(\" fullword ascii\n        $s10 = \"lazagne.config.\" ascii\n    condition:\n       uint16(0) == 0x5a4d and any of them\n}\n\nrule INDICATOR_TOOL_PWS_Credstealer {\n    meta:\n        description = \"Detects Python executable for stealing credentials including domain environments. Observed in MuddyWater.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"PYTHON27.DLL\" fullword wide\n        $s2 = \"C:\\\\Python27\\\\lib\\\\site-packages\\\\py2exe\\\\boot_common.pyR\" fullword ascii\n        $s3 = \"C:\\\\Python27\\\\lib\\\\site-packages\\\\py2exe\\\\boot_common.pyt\" fullword ascii\n        $s4 = \"subprocess.pyc\" fullword ascii\n        $s5 = \"MyGetProcAddress(%p, %p(%s)) -> %p\" fullword ascii\n        $p1 = \"Dump SAM hashes from target systemss\" fullword ascii\n        $p2 = \"Dump LSA secrets from target systemss\" fullword ascii\n        $p3 = \"Dump the NTDS.dit from target DCs using the specifed method\" fullword ascii\n        $p4 = \"Dump NTDS.dit password historys\" fullword ascii\n        $p5 = \"Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameterss\" fullword ascii\n        $p6 = \"Retrieve plaintext passwords and other information for accounts pushed through Group Policy Preferencess\" fullword ascii\n        $p7 = \"Combo file containing a list of domain\\\\username:password or username:password entriess\" fullword ascii\n    condition:\n       uint16(0) == 0x5a4d and (3 of ($s*) and 1 of ($p*))\n}\n\nrule INDICATOR_TOOL_CNC_Shootback {\n    meta:\n        description = \"detects Python executable for CnC communication via reverse tunnels. Used by MuddyWater group.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"PYTHON27.DLL\" fullword wide\n        $s2 = \"C:\\\\Python27\\\\lib\\\\site-packages\\\\py2exe\\\\boot_common.pyR\" fullword ascii\n        $s3 = \"C:\\\\Python27\\\\lib\\\\site-packages\\\\py2exe\\\\boot_common.pyt\" fullword ascii\n        $s4 = \"subprocess.pyc\" fullword ascii\n        $s5 = \"MyGetProcAddress(%p, %p(%s)) -> %p\" fullword ascii\n        $p1 = \"Slaver(this pc):\" ascii\n        $p2 = \"Master(another public server):\" ascii\n        $p3 = \"Master(this pc):\" ascii\n        $p4 = \"running as slaver, master addr: {} target: {}R/\" fullword ascii\n        $p5 = \"Customer(this pc): \" ascii\n        $p6 = \"Customer(any internet user):\" ascii\n        $p7 = \"the actual traffic is:  customer <--> master(1.2.3.4) <--> slaver(this pc) <--> ssh(this pc)\" fullword ascii\n    condition:\n       uint16(0) == 0x5a4d and (3 of ($s*) and 2 of ($p*))\n}\n\nrule INDICATOR_TOOL_PWS_Fgdump {\n    meta:\n        description = \"detects all versions of the password dumping tool, fgdump. Observed to be used by DustSquad group.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"dumping server %s\" ascii\n        $s2 = \"dump on server %s\" ascii\n        $s3 = \"dump passwords: %s\" ascii\n        $s4 = \"Dumping cache\" nocase ascii\n        $s5 = \"SECURITY\\\\Cache\" ascii\n        $s6 = \"LSASS.EXE process\" ascii\n        $s7 = \" AntiVirus \" nocase ascii\n        $s8 = \" IPC$ \" ascii\n        $s9 = \"Exec failed, GetLastError returned %d\" fullword ascii\n        $10 = \"writable connection to %s\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_PWS_SharpWeb {\n    meta:\n        description = \"detects all versions of the browser password dumping .NET tool, SharpWeb.\"\n        author = \"ditekSHen\"\n    strings:\n        $param1 = \"logins\" nocase wide\n        $param2 = \"cookies\" nocase wide\n        $param3 = \"edge\" nocase wide\n        $param4 = \"firefox\" nocase wide\n        $param5 = \"chrome\" nocase wide\n\n        $path1 = \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Login Data\" wide\n        $path2 = \"\\\\AppData\\\\Roaming\\\\Mozilla\\\\Firefox\\\\Profiles\\\\\" wide\n        $path3 = \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Cookies\" wide\n        $path4 = \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Bookmarks\" wide\n\n        $sql1 = \"UPDATE sqlite_temp_master SET sql = sqlite_rename_trigger(sql, %Q), tbl_name = %Q WHERE %s;\" nocase wide\n        $sql2 = \"UPDATE %Q.%s SET type='%s', name=%Q, tbl_name=%Q, rootpage=#%d, sql=%Q WHERE rowid=#%d\" nocase wide\n        $sql3 = \"SELECT action_url, username_value, password_value FROM logins\" nocase wide\n\n        $func1 = \"get_encryptedPassword\" fullword ascii\n        $func2 = \"<GetLogins>g__GetVaultElementValue0_0\" fullword ascii\n        $func3 = \"<encryptedPassword>k__BackingField\" fullword ascii\n\n        $pdb = \"\\\\SharpWeb\\\\obj\\\\Debug\\\\SharpWeb.pdb\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and ((1 of ($func*) and 3 of ($param*) and (1 of ($path*) or 1 of ($sql*))) or $pdb)\n}\n\nrule INDICATOR_TOOL_PWS_Blackbone {\n    meta:\n        description = \"detects Blackbone password dumping tool on Windows 7-10 operating system.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"BlackBone: %s: \" ascii\n        $s2 = \"\\\\BlackBoneDrv\\\\\" ascii\n        $s3 = \"\\\\DosDevices\\\\BlackBone\" fullword wide\n        $s4 = \"\\\\Temp\\\\BBImage.manifest\" wide\n        $s5 = \"\\\\Device\\\\BlackBone\" fullword wide\n        $s6 = \"BBExecuteInNewThread\" fullword ascii\n        $s7 = \"BBHideVAD\" fullword ascii\n        $s8 = \"BBInjectDll\" fullword ascii\n        $s9 = \"ntoskrnl.exe\" fullword ascii\n        $s10 = \"WDKTestCert Ton,\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_PWS_Mimikatz {\n    meta:\n        description = \"Detects Mimikatz.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"mimilib.dll\" ascii\n        $s2 = \"mimidrv.sys\" ascii\n        $s3 = \"mimikatz.exe\" ascii\n        $s4 = \"\\\\mimidrv.pdb\" ascii\n        $s5 = \"mimikatz\" ascii\n        $s6 = { 6d 00 69 00 6d 00 69 00 6b 00 61 00 74 00 7a }  // m|00|i|00|m|00|i|00|k|00|a|00|t|00|z\n        $s7 = { 5c 00 6d 00 69 00 6d 00 69 00 64 00 72 00 76 }  // \\|00|m|00|i|00|m|00i|00|d|00|r|00|v\n        $s8 = { 6d 00 69 00 6d 00 69 00 64 00 72 00 76 }        // m|00|i|00|m|00i|00|d|00|r|00|v\n        $s9 = \"Lecture KIWI_MSV1_0_\" ascii\n        $s10 = \"Search for LSASS process\" ascii\n\n        $f1 = \"SspCredentialList\" ascii\n        $f2 = \"KerbGlobalLogonSessionTable\" ascii\n        $f3 = \"LiveGlobalLogonSessionList\" ascii\n        $f4 = \"TSGlobalCredTable\" ascii\n        $f5 = \"g_MasterKeyCacheList\" ascii\n        $f6 = \"l_LogSessList\" ascii\n        $f7 = \"lsasrv!\" ascii\n        $f8 = \"SekurLSA\" ascii\n        $f9 = /Cached(Unlock|Interative|RemoteInteractive)/ ascii\n\n        // https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar\n        $dll_1 = { c7 0? 00 00 01 00 [4-14] c7 0? 01 00 00 00 }\n\t\t$dll_2 = { c7 0? 10 02 00 00 ?? 89 4? }\n        $sys_x86 = { a0 00 00 00 24 02 00 00 40 00 00 00 [0-4] b8 00 00 00 6c 02 00 00 40 00 00 00 }\n\t\t$sys_x64 = { 88 01 00 00 3c 04 00 00 40 00 00 00 [0-4] e8 02 00 00 f8 02 00 00 40 00 00 00 }\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($*) or 3 of ($f*) or all of ($dll_*) or any of ($sys_*))\n}\n\nrule INDICATOR_TOOL_SCN_PortScan {\n    meta:\n        description = \"Detects a port scanner tool observed as second or third stage post-compromise or dropped by malware.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"HEAD / HTTP/1.0\" fullword ascii\n        $s2 = \"Result.txt\" fullword ascii\n        $s3 = \"Example: %s SYN \" ascii\n        $s4 = \"Performing Time: %d/%d/%d %d:%d:%d -->\" fullword ascii\n        $s5 = \"Bind On IP: %d.%d.%d.%d\" fullword ascii\n        $s6 = \"SYN Scan: About To Scan %\" ascii\n        $s7 = \"Normal Scan: About To Scan %\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_MEM_mXtract {\n    meta:\n        description = \"Detects mXtract, a linux-based tool that dumps memory for offensive pentration testing and can be used to scan memory for private keys, ips, and passwords using regexes.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"_ZN18process_operations10get_rangesEv\" fullword ascii\n        $s2 = \"_ZN4misc10write_dumpESsSs\" fullword ascii\n        $s3 = \"_ZTVNSt8__detail13_Scanner_baseE\" fullword ascii\n        $s4 = \"Running as root is recommended as not all PIDs will be scanned\" fullword ascii\n        $s5 = \"ERROR ATTACHING TO PROCESS\" fullword ascii\n        $s6 = \"ERROR SCANNING MEMORY RANGE\" fullword ascii\n    condition:\n        (uint32(0) == 0x464c457f or uint16(0) == 0x457f) and 3 of them\n}\n\nrule INDICATOR_TOOL_PWS_SniffPass {\n    meta:\n        description = \"Detects SniffPass, a password monitoring software that listens on the network and captures passwords over POP3, IMAP4, SMTP, FTP, and HTTP.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"\\\\Release\\\\SniffPass.pdb\" ascii\n        $s2 = \"Password   Sniffer\" fullword wide\n        $s3 = \"Software\\\\NirSoft\\\\SniffPass\" fullword ascii\n        $s4 = \"Sniffed PasswordsCFailed to start\" wide\n        $s5 = \"Pwpcap.dll\" fullword ascii\n        $s6 = \"nmwifi.exe\" fullword ascii\n        $s7 = \"NmApi.dll\" fullword ascii\n        $s8 = \"npptools.dll\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_AVBypass_AVIator {\n    meta:\n        description = \"Detects AVIator, which is a backdoor generator utility, which uses cryptographic and injection techniques in order to bypass AV detection. This was observed to bypass Win.Trojan.AZorult. This rule works for binaries and memory.\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"msfvenom -p windows/meterpreter\" ascii wide\n        $s2 = \"payloadBox.Text\" ascii wide\n        $s3 = \"APCInjectionCheckBox\" ascii wide\n        $s4 = \"Thread Hijacking (Shellcode Arch: x86, OS Arch: x86)\" ascii wide\n        $s5 = \"injectExistingApp.Text\" ascii wide\n        $s6 = \"Stable execution but can be traced by most AVs\" ascii wide\n        $s7 = \"AV/\\\\tor\" ascii wide\n        $s8 = \"AvIator.Properties.Resources\" ascii wide\n        $s9 = \"Select injection technique\" ascii wide\n        $s10 = \"threadHijacking_option\" ascii wide\n\n        $pwsh1 = \"Convert.ToByte(Payload_Encrypted_Without_delimiterChar[\" ascii wide\n        $pwsh2 = \"[DllImport(\\\"kernel32.dll\\\", SetLastError = true)]\" ascii wide\n        $pwsh3 = \"IntPtr RtlAdjustPrivilege(\" ascii wide\n        $pwsh4 = /InjectShellcode\\.(THREADENTRY32|CONTEXT64|WriteProcessMemory\\(|CloseHandle\\(|CONTEXT_FLAGS|CONTEXT\\(\\);|Thread32Next\\()/ ascii wide\n        $pwsh5 = \"= Payload_Encrypted.Split(',');\" ascii wide\n        $pwsh6 = \"namespace NativePayload_Reverse_tcp\" ascii wide\n        $pwsh7 = \"byte[] Finall_Payload = Decrypt(KEY, _X_to_Bytes);\" ascii wide\n        $pwsh8 = /ConstantsAndExtCalls\\.(WriteProcessMemory\\(|CreateRemoteThread\\()/ ascii wide\n    condition:\n        (uint16(0) == 0x5a4d and (3 of ($s*) or 2 of ($pwsh*))) or (3 of ($s*) or 2 of ($pwsh*))\n}\n\nrule INDICATOR_TOOL_PWS_PwDump7 {\n    meta:\n        description = \"Detects Pwdump7 password Dumper\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"savedump.dat\" fullword ascii\n        $s2 = \"Asd -_- _RegEnumKey fail!\" fullword ascii\n        $s3 = \"\\\\SAM\\\\\" ascii\n        $s4 = \"Unable to dump file %S\" fullword ascii\n        $s5 = \"NO PASSWORD\" ascii\n    condition:\n        (uint16(0) == 0x5a4d and 4 of them) or (all of them)\n}\n\nrule INDICATOR_TOOL_LTM_SharpExec {\n    meta:\n        description = \"Detects SharpExec lateral movement tool\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"fileUploaded\" fullword ascii\n        $s2 = \"$7fbad126-e21c-4c4e-a9f0-613fcf585a71\" fullword ascii\n        $s3 = \"DESKTOP_HOOKCONTROL\" fullword ascii\n        $s4 = /WINSTA_(ACCESSCLIPBOARD|WINSTA_ALL_ACCESS)/ fullword ascii\n        $s5 = /NETBIND(ADD|DISABLE|ENABLE|REMOVE)/ fullword ascii\n        $s6 = /SERVICE_(ALL_ACCESS|WIN32_OWN_PROCESS|INTERROGATE)/ fullword ascii\n        $s7 = /(Sharp|PS|smb)Exec/ fullword ascii\n        $s8 = \"lpszPassword\" fullword ascii\n        $s9 = \"lpszDomain\" fullword ascii\n        $s10 = \"wmiexec\" fullword ascii\n        $s11 = \"\\\\C$\\\\__LegitFile\" wide\n        $s12 = \"LOGON32_LOGON_NEW_CREDENTIALS\" fullword ascii\n    condition:\n        (uint16(0) == 0x5a4d and 9 of them) or (all of them)\n}\n\nrule INDICATOR_TOOL_PRV_AdvancedRun {\n    meta:\n        description = \"Detects NirSoft AdvancedRun privialge escalation tool\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"RunAsProcessName\" fullword wide\n        $s2 = \"Process ID/Name:\" fullword wide\n        $s3 = \"swinsta.dll\" fullword wide\n        $s4 = \"User of the selected process0Child of selected process (Using code injection) Specified user name and password\" fullword wide\n        $s5 = \"\\\"Current User - Allow UAC Elevation$Current User - Without UAC Elevation#Administrator (Force UAC Elevation)\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_PWS_Amady {\n    meta:\n        description = \"Detects password stealer DLL. Dropped by Amady\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Shell Folders\\\\AppData\" fullword ascii\n        $s2 = \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows Messaging Subsystem\\\\Profiles\\\\Outlook\" ascii\n        $s3 = \"\\\\Mikrotik\\\\Winbox\\\\Addresses.cdb\" fullword ascii\n        $s4 = \"\\\\HostName\" fullword ascii\n        $s5 = \"\\\\Password\" fullword ascii\n        $s6 = \"SOFTWARE\\\\RealVNC\\\\\" ascii\n        $s7 = \"SOFTWARE\\\\TightVNC\\\\\" ascii\n        $s8 = \"cred.dll\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and filesize < 400KB and 7 of them\n}\n\nrule INDICATOR_TOOL_SCR_Amady {\n    meta:\n        description = \"Detects screenshot stealer DLL. Dropped by Amady\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"User-Agent: Uploador\" fullword ascii\n        $s2 = \"Content-Disposition: form-data; name=\\\"data\\\"; filename=\\\"\" fullword ascii\n        $s3 = \"WebUpload\" fullword ascii\n        $s4 = \"Cannot assign a %s to a %s%List does not allow duplicates ($0%x)%String\" wide\n        $s5 = \"scr.dll\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and filesize < 700KB and 4 of them\n}\n\nrule INDICATOR_TOOL_EXP_EternalBlue {\n    meta:\n        description = \"Detects Windows executables containing EternalBlue explitation artifacts\"\n        author = \"ditekSHen\"\n    strings:\n        $ci1 = \"CNEFileIO_\" ascii wide\n        $ci2 = \"coli_\" ascii wide\n        $ci3 = \"mainWrapper\" ascii wide\n\n        $dp1 = \"EXPLOIT_SHELLCODE\" ascii wide\n        $dp2 = \"ETERNALBLUE_VALIDATE_BACKDOOR\" ascii wide\n        $dp3 = \"ETERNALBLUE_DOUBLEPULSAR_PRESENT\" ascii wide\n        $dp4 = \"//service[name='smb']/port\" ascii wide\n        $dp5 = /DOUBLEPULSAR_(PROTOCOL_|ARCHITECTURE_|FUNCTION_|DLL_|PROCESS_|COMMAND_|IS_64_BIT)/\n\n        $cm1 = \"--DllOrdinal 1 ProcessName lsass.exe --ProcessCommandLine --Protocol SMB --Architecture x64 --Function Rundll\" ascii wide\n        $cm2 = \"--DllOrdinal 1 ProcessName lsass.exe --ProcessCommandLine --Protocol SMB --Architecture x86 --Function Rundll\" ascii wide\n        $cm3 = \"--DaveProxyPort=0 --NetworkTimeout 30 --TargetPort 445 --VerifyTarget True --VerifyBackdoor True --MaxExploitAttempts 3 --GroomAllocations 12 --OutConfig\" ascii wide\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($ci*)) or (2 of ($dp*)) or (1 of ($dp*) and 1 of ($ci*)) or (1 of ($cm*))\n}\n\nrule INDICATOR_TOOL_EXP_WebLogic {\n    meta:\n        description = \"Detects Windows executables containing Weblogic exploits commands\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"certutil.exe -urlcache -split -f AAAAA BBBBB & cmd.exe /c BBBBB\" ascii\n        $s2 = \"powershell (new-object System.Net.WebClient).DownloadFile('AAAAA','BBBBB')\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 1 of them\n}\n\nrule INDICATOR_TOOL_EXP_ApacheStrusts {\n    meta:\n        description = \"Detects Windows executables containing ApacheStruts exploit artifatcs\"\n        author = \"ditekSHen\"\n    strings:\n        // CVE-2017-5638\n        $x1 = \"apache.struts2.ServletActionContext@getResponse\" ascii\n        $e1 = \".getWriter()\" ascii\n        $e2 = \".getOutputStream()\" ascii\n        $e3 = \".getInputStream()\" ascii\n\n        // CVE-2018-11776\n        $x2 = \"#_memberAccess\" ascii\n        $s1 = \"ognl.OgnlContext\" ascii\n        $s2 = \"ognl.ClassResolver\" ascii\n        $s3 = \"ognl.TypeConverter\" ascii\n        $s4 = \"ognl.MemberAccess\" ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f) and ($x1 and 2 of ($e*)) or ($x2 and 1 of ($s*))\n}\n\nrule INDICATOR_TOOL_SCN_SMBTouch {\n    meta:\n        description = \"Detects SMBTouch scanner EternalBlue, EternalChampion, EternalRomance, EternalSynergy\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"[+] SMB Touch started\" fullword ascii\n        $s2 = \"[-] Could not connect to share (0x%08X - %s)\" fullword ascii\n        $s3 = \"[!] Target could be either SP%d or SP%d,\" fullword ascii\n        $s4 = \"[!] for these SMB exploits they are equivalent\" fullword ascii\n        $s5 = \"[+] Target is vulnerable to %d exploit%s\" fullword ascii\n        $s6 = \"[+] Touch completed successfully\" fullword ascii\n        $s7 = \"Network error while determining exploitability\" fullword ascii\n        $s8 = \"Named pipe or share required for exploit\" fullword ascii\n        $w1 = \"UsingNbt\" fullword ascii\n        $w2 = \"TargetPort\" fullword ascii\n        $w3 = \"TargetIp\" fullword ascii\n        $w4 = \"RedirectedTargetPort\" fullword ascii\n        $w5 = \"RedirectedTargetIp\" fullword ascii\n        $w6 = \"NtlmHash\" fullword ascii\n        $w7 = \"\\\\PIPE\\\\LANMAN\" fullword ascii\n        $w8 = \"UserRejected: \" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($s*) or all of ($w*))\n}\n\nrule INDICATOR_TOOL_SCN_NBTScan {\n    meta:\n        description = \"Detects NBTScan scanner for open NETBIOS nameservers on a local or remote TCP/IP network\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"[%s] is an invalid target (bad IP/hostname)\" fullword ascii\n        $s2 = \"ERROR: no parse for %s -- %s\" fullword ascii\n        $s3 = \"add_target failed\" fullword ascii\n        $s4 = \"   -p <n>    bind to UDP Port <n> (default=%d)\" fullword ascii\n        $s5 = \"process_response.c\" fullword ascii\n        $s6 = \"currTarget != 0\" fullword ascii\n        $s7 = \"parse_target.c\" fullword ascii\n        $s8 = \"dump_packet.c\" fullword ascii\n        $s9 = \"parse_target_cb.c\" fullword ascii\n        $s10 = \"DUMP OF PACKET\" fullword ascii\n        $s11 = \"lookup_hostname.c\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 10 of ($s*)\n}\n\nrule INDICATOR_TOOL_LTM_CompiledImpacket {\n    meta:\n        description = \"Detects executables of compiled Impacket's python scripts\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"impacket(\" fullword ascii\n        $s2 = \"impacket.dcerpc(\" fullword ascii\n        $s3 = \"impacket.krb5(\" fullword ascii\n        $s4 = \"impacket.smb(\" fullword ascii\n        $s5 = \"impacket.smb3(\" fullword ascii\n        $s6 = \"impacket.winregistry(\" fullword ascii\n        $s7 = \"impacket.ntlm(\" fullword ascii\n        $m1 = \"inspect(\" fullword ascii\n        $m2 = \"pickle(\" fullword ascii\n        $m3 = \"spsexec\" fullword ascii\n        $m4 = \"schecker\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($s*) or (3 of ($m*) and 1 of ($s*)))\n}\n\nrule INDICATOR_TOOL_ENC_BestCrypt {\n    meta:\n        description = \"Detects BestEncrypt commercial disk encryption and wiping software\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"BestCrypt Volume Encryption\" wide\n        $s2 = \"BCWipe for \" wide\n        $s3 = \"Software\\\\Jetico\\\\BestCrypt\" wide\n        $s4 = \"%c:\\\\EFI\\\\Jetico\\\\\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_CNC_Earthworm {\n    meta:\n        description = \"Detects Earthworm C&C Windows/macOS tool\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"lcx_tran 0.0.0.0:%d <--[%4d usec]--> %s:%d\" fullword ascii\n        $s2 = \"ssocksd 0.0.0.0:%d <--[%4d usec]--> socks server\" fullword ascii\n        $s3 = \"rcsocks 0.0.0.0:%d <--[%4d usec]--> 0.0.0.0:%d\" fullword ascii\n        $s4 = \"rssocks %s:%d <--[%4d usec]--> socks server\" fullword ascii\n        $s5 = \"--> %3d <-- (close)used/unused  %d/%d\" fullword ascii\n        $s6 = \"<-- %3d --> (open)used/unused  %d/%d\" fullword ascii\n        $s7 = \"--> %d start server\" ascii\n        $s8 = \"Error on connect %s:%d [proto_init_cmd_rcsocket]\" fullword ascii\n        $url = \"http://rootkiter.com/EarthWrom/\" nocase fullword ascii\n    condition:\n        (uint16(0) == 0xfacf or uint16(0) == 0x5a4d) and (5 of ($s*) or $url)\n}\n\nrule INDICATOR_TOOL_PET_p0wnedShell {\n    meta:\n        description = \"Detects compiled executables of p0wnedShell post-exploitation toolkit\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"Use WinRM, PsExec, SMB/WMI to execute commands on remote systems\" wide\n        $s2 = \"-CreateProcess \\\"cmd.exe\\\" -Username \\\"nt authority\\\\system\\\"\" wide\n        $s3 = \"-Command '\\\"lsadump::dcsync /user:\" wide\n        $s4 = \"-Payload windows/meterpreter/reverse_https -Lhost\" wide\n        $s5 = \"Get-Content ./EncodedPayload.bat\" fullword wide\n        $e1 = \"OnYNAB+LCAAAAAAABAC8vOeS60iSLvh75yly+rZZVxuqC4KQs3uvLQhFEJIACALoHVuD1oKQBMbuuy+Y4pw8dUTf3R+bZlWVZHh87uHh4vPItv63ZGrCMW+bF7GZ2zL+\" wide\n        $e2 = \"kuIeAB+LCAAAAAAABADsvWt327iuMPw9v0Jv27Wa7DqJc2ma5nl71vZFTpzx/ZJL+3TlyLZiq7EtjyTHcffZ//0BSEqiKEqWbKczs8941qS2LgAIAiAIguDjfNp3DHOq\" wide\n        $e3 = \"mZYIAB+LCAAAAAAABADsvflj2zyOMPx7/gptmnftbBIfuZp0t/OOfMZp7PjO0adfX9lSbCWy5Vp2HGfm+d8/ACQl6vCRNp2Z3bVmnioWSRAEQQAESfC/Pmwp8FTtmTFu\" wide\n        $e4 = \"u9YGAB+LCAAAAAAABADsvW1D40ayKPw9v0Lr4V7ZE8vY5mUY9rKJBzMTnmWAgyGTvYTlCluAdmzJK9nDsEn++1NV/S61ZJmXZJIN52wG7O7q6urq6qrqquoXSfDveZgE\" wide\n        $e5 = \"T3gDAB+LCAAAAAAABADtvX1f2zq2KPz3yafQzuZcwi5JEydQ2nM7v4cCnc0zQLmE7j3z6+7NmMQBnwY7YzsFTqff/WpJsi3Jki07DlA2mT008ctaS0tL601L0nThjSPX\" wide\n        $e6 = \"zRgDAB+LCAAAAAAABADtfW1327jR6OdHv4Kr9TmWdiVZkl+SdZs913Gcrm9tx7WcbvekuS4t0TYbiVRJKYmfbf77xeCNeCVBinKcbNStI5HAYDAYDAaDwczNMhovwjjy\" wide\n        $e7 = \"pxICAB+LCAAAAAAABADtvf17GkeyKPyz+Cvmlfw+ggRhfcXr1X1znsUIx5yVhC7IUbI+fnUHGKRZwww7M1jWyeZ/v1XV3z09wABysnviZ1cBpqe6urqquqq6uno8j4ZZ\" wide\n        $e8 = \"H4sIAAAAAAAEANy9e3wTVfo4PG1SmkLbCdpgFdSgUeuCbLTAthYk005gQhNahUIVkCqIqKi1TaAuIGBaJRzG27Kuul5wV3fV1fUuUFxNKbTl3oJAuaiouE4paAGBFpB5\" wide\n        $k1 = \"EasySystemPPID\" fullword ascii\n        $k2 = \"EasySystemShell\" fullword ascii\n        $k3 = \"LatMovement\" fullword ascii\n        $k4 = \"ListenerURL\" fullword ascii\n        $k5 = \"MeterStager\" fullword ascii\n        $k6 = \"PatchEventLog\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (3 of ($s*) or 7 of ($e*) or all of ($k*) or (2 of ($s*) and 2 of ($e*) and 2 of ($k*)))\n}\n\nrule INDICATOR_TOOL_PWS_Rubeus {\n    meta:\n        description = \"Detects Rubeus kerberos defensive/offensive toolset\"\n        author = \"ditekSHen\"\n    strings:\n        $s1 = \"(&(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))\" fullword wide\n        $s2 = \"(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2))\" fullword wide\n        $s3 = \"rc4opsec\" fullword wide\n        $s4 = \"pwdlastset\" fullword wide\n        $s5 = \"LsaEnumerateLogonSessions\" fullword ascii\n        $s6 = \"extractKerberoastHash\" fullword ascii\n        $s7 = \"ComputeAllKerberosPasswordHashes\" fullword ascii\n        $s8 = \"kerberoastDomain\" fullword ascii\n        $s9 = \"GetUsernamePasswordTGT\" fullword ascii\n        $s10 = \"WriteUserPasswordToFile\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 8 of them\n}\n\nrule INDICATOR_TOOL_RTK_HiddenRootKit {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects the Hidden public rootkit\"\n    strings:\n        $h1 = \"Hid_State\" fullword wide\n        $h2 = \"Hid_StealthMode\" fullword wide\n        $h3 = \"Hid_HideFsDirs\" fullword wide\n        $h4 = \"Hid_HideFsFiles\" fullword wide\n        $h5 = \"Hid_HideRegKeys\" fullword wide\n        $h6 = \"Hid_HideRegValues\" fullword wide\n        $h7 = \"Hid_IgnoredImages\" fullword wide\n        $h8 = \"Hid_ProtectedImages\" fullword wide\n        $s1 = \"FLTMGR.SYS\" fullword ascii\n        $s2 = \"HAL.dll\" fullword ascii\n        $s3 = \"\\\\SystemRoot\\\\System32\\\\csrss.exe\" fullword wide\n        $s4 = \"\\\\REGISTRY\\\\MACHINE\\\\SYSTEM\\\\ControlSet001\\\\%wZ\" fullword wide\n        $s5 = \"INIT\" fullword ascii\n        $s6 = \"\\\\hidden-master\\\\Debug\\\\QAssist.pdb\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (3 of ($h*) or 5 of ($s*) or (2 of ($s*) and 2 of ($h*)))\n}\n\nrule INDICATOR_TOOL_PET_SharpHound {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects BloodHound\"\n    strings:\n        $id1 = \"InvokeBloodHound\" fullword ascii\n        $id2 = \"Sharphound\" ascii nocase\n        $s1 = \"SamServerExecute\" fullword ascii\n        $s2 = \"get_RemoteDesktopUsers\" fullword ascii\n        $s3 = \"commandline.dll.compressed\" ascii wide\n        $s4 = \"operatingsystemservicepack\" fullword wide\n        $s5 = \"LDAP://\" fullword wide\n        $s6 = \"wkui1_logon_domain\" fullword ascii\n        $s7 = \"GpoProps\" fullword ascii\n        $s8 = \"a517a8de-5834-411d-abda-2d0e1766539c\" fullword ascii nocase\n    condition:\n        uint16(0) == 0x5a4d and (all of ($id*) or 6 of ($s*) or (1 of ($id*) and 4 of ($s*)))\n}\n\nrule INDICATOR_TOOL_UAC_NSISUAC {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects NSIS UAC plugin\"\n    strings:\n        $s1 = \"HideCurrUserOpt\" fullword wide\n        $s2 = \"/UAC:%X /NCRC%s\" fullword wide\n        $s3 = \"2MyRunAsStrings\" fullword wide\n        $s4 = \"CheckElevationEnabled\" fullword ascii\n        $s5 = \"UAC.dll\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_REM_IntelliAdmin {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects commerical IntelliAdmin remote tool\"\n    strings:\n        $pdb1 = \"\\\\Network Administrator\" ascii\n        $pdb2 = \"\\\\Binaries\\\\Plugins\\\\Tools\\\\RPCService.pdb\" ascii\n        $s1 = \"CIntelliAdminRPC\" fullword wide\n        $s2 = \"IntelliAdmin RPC Service\" fullword wide\n        $s3 = \"IntelliAdmin Remote Execute v\" ascii\n        $s4 = \"IntelliAdminRPC\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($pdb*) or 2 of ($s*))\n}\n\nrule INDICATOR_TOOL_PET_SharpWMI {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpWMI\"\n    strings:\n        $s1 = \"scriptKillTimeout\" fullword ascii\n        $s2 = \"RemoteWMIExecuteWithOutput\" fullword ascii\n        $s3 = \"RemoteWMIFirewall\" fullword ascii\n        $s4 = \"iex([char[]](@({0})|%{{$_-bxor{1}}}) -join '')\" fullword wide\n        $s5 = \"\\\\\\\\{0}\\\\root\\\\subscription\" fullword wide\n        $s6 = \"_Context##RANDOM##\" fullword wide\n        $s7 = \"executevbs\" fullword wide\n        $s8 = \"scriptb64\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_PET_DefenderControl {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Defender Control\"\n    strings:\n        $s1 = \"Windows Defender Control\" wide\n        $s2 = \"www.sordum.org\" wide ascii\n        $s3 = \"dControl\" wide\n    condition:\n        uint16(0) == 0x5a4d and 2 of them\n}\n\nrule INDICATOR_TOOL_PET_Mulit_VenomAgent {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Venom Proxy Agent\"\n    strings:\n        $s1 = \"github.com/Dliv3/Venom/\" ascii\n        $s2 = \"3HpKQVB3nT3qaNQPT-ZU/SKJ55ofz5TEmg5O3ROWA/CUs_-gfa04tGVO633Z4G/OSeEpRRb0Sq_5R6ArIi-\" ascii\n        $s3 = \"venom_agent -\" ascii\n        $s4 = \"bufferssh-userauthtransmitfileunknown portwirep: p->m= != sweepgen\" ascii\n        $s5 = \"golang.org/x/crypto/ssh.(*handshakeTransport).readPacket\"\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f or uint16(0) == 0xfacf) and 3 of them\n}\n\nrule INDICATOR_TOOL_HFS_WebServer {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects HFS Web Server\"\n    strings:\n        $s1 = \"SOFTWARE\\\\Borland\\\\Delphi\\\\\" ascii\n        $s2 = \"C:\\\\code\\\\mine\\\\hfs\\\\scriptLib.pas\" fullword ascii\n        $s3 = \"hfs.*;*.htm*;descript.ion;*.comment;*.md5;*.corrupted;*.lnk\" ascii\n        $s4 = \"Server: HFS\" ascii\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_PROX_lanproxy {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects lanproxy-go-client\"\n    strings:\n        $s1 = \"serverShare\" fullword ascii\n        $s2 = \"parkingOnChan\" fullword ascii\n        $s3 = \"{{join .Names \\\", \\\"}}{{\\\"\\\\t\\\"}}{{.Usage}}{{end}}{{end}}{{end}}{{end}}{{\" ascii\n        $s4 = \"</table></thead></tbody>\" fullword ascii\n        $s5 = \"value=aacute;abreve;addressagrave;alt -> andand;angmsd;angsph;any -> apacir;approx;articleatilde;barvee;barwed;bdoUxXvbecaus;ber\" ascii\n        $s6 = \"/dev/urandom127.0.0.1:\" ascii\n        $s7 = \"non-IPv4 addressnon-IPv6 addressntrianglelefteq;object is remotepacer: H_m_prev=reflect mismatchregexp: Compile(remote I/O error\" ascii\n        $s8 = \".WithDeadline(.in-addr.arpa.\" ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f) and 6 of them\n}\n\nrule INDICATOR_TOOL_PET_Peirates {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Kubernetes penetration tool Peirates\"\n    strings:\n        $s1 = \"DeprecatedServiceAccount\" fullword ascii\n        $s2 = \"LivenessProbe\" fullword ascii\n        $s3 = \"\\\\t\\\\tkubectl expose rs nginx --port=80 --target-port=8000\" ascii\n        $s4 = \"\\\\t\\\\tkubectl run hazelcast --image=hazelcast --port=5701\" ascii\n        $s5 = \"COMPREPLY[$i]=${COMPREPLY[$i]#\\\"$colon_word\\\"}\" ascii\n        $s6 = \"%*polymorphichelpers.HistoryViewerFunc\" ascii\n        $s7 = \"ListenAndServeTLS\" ascii\n        $s8 = \"DownwardAPI\" ascii\n        $s9 = \"; plural=(n%10==1 && n%100!=11 ? 0 : n != 0 ? 1 : 2);proto:\" ascii\n        $s10 = \"name: attack-\" ascii\n    condition:\n       uint16(0) == 0x457f and 9 of them\n}\n\nrule INDICATOR_TOOL_PET_BOtB {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Break out the Box (BOtB)\"\n    strings:\n        $s1 = \"to unallocated span%%!%c(*big.Float=%s), RecursionDesired: /usr/share/zoneinfo//{Bucket}/{Key+}?acl/{Bucket}?accelerate/{Bucket}?encryption/{Bucket}?\" ascii\n        $s2 = \"exploit CVE-2019-5736 with command: [ERROR] In Enabling CGROUP Notifications -> 'echo 1 > [INFO] CGROUP may exist, attempting exploit regardless\" ascii\n        $s3 = \"main.execShellCmd\" ascii\n        $s4 = \"[*] Data uploaded to:[+]\" ascii\n        $s5 = \"whitespace or line breakfailed to find credentials in the environment.failed to get %s EC2 instance role credentialsfirst\" ascii\n        $s6 = \"This process will exit IF an EXECVE is called in the Container or if the Container is manually stoppedPerform reverse DNS lookups\" ascii\n        $s7 = \"http: request too largehttp://100.100.100.200/http://169.254.169.254/index out of range\" ascii\n    condition:\n       uint16(0) == 0x457f and 6 of them\n}\n\nrule INDICATOR_TOOL_PWS_LSASS_CreateMiniDump {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects CreateMiniDump tool\"\n    strings:\n        $s1 = \"lsass.dmp\" fullword wide\n        $s2 = \"lsass dumped successfully!\" ascii\n        $s3 = \"Got lsass.exe PID:\" ascii\n        $s4 = \"\\\\experiments\\\\CreateMiniDump\\\\CreateMiniDump\\\\\" ascii\n        $s5 = \"MiniDumpWriteDump\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 2 of them\n}\n\nrule INDICATOR_TOOL_PWS_SecurityXploded_BrowserPasswordDumper {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SecurityXploded Browser Password Dumper tool\"\n    strings:\n        $s1 = \"\\\\projects\\\\windows\\\\BrowserPasswordDump\\\\Release\\\\FireMaster.pdb\" ascii\n        $s2 = \"%s: Dumping passwords\" fullword ascii\n        $s3 = \"%s - Found login data file...dumping the passwords from file %s\" fullword ascii\n        $s4 = \"%s Dumping secrets from login json file %s\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_PWS_SecurityXploded_FTPPasswordDumper {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SecurityXploded FTP Password Dumper tool\"\n    strings:\n        $s1 = \"\\\\projects\\\\windows\\\\FTPPasswordDump\\\\Release\\\\FireMaster.pdb\" ascii\n        $s2 = \"//Dump all the FTP passwords to a file \\\"c:\\\\passlist.txt\\\"\" ascii\n        $s3 = \"//Dump all the FTP passwords to console\" ascii\n        $s4 = \"FTP Password Dump\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_PWS_SecurityXploded_EmailPasswordDumper {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SecurityXploded Email Password Dumper tool\"\n    strings:\n        $s1 = \"\\\\projects\\\\windows\\\\EmailPasswordDump\\\\Release\\\\FireMaster.pdb\" ascii\n        $s2 = \"//Dump all the Email passwords to a file \\\"c:\\\\passlist.txt\\\"\" ascii\n        $s3 = \"EmailPasswordDump\" fullword wide\n        $s4 = \"//Dump all the Email passwords to console\" ascii\n        $s5 = \"Email Password Dump\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_PET_SharpSphere {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpSphere red teamers tool to interact with the guest operating systems of virtual machines managed by vCenter\"\n    strings:\n        $s1 = \"get_virtualExecUsage\" fullword ascii\n        $s2 = \"Command to execute\" fullword ascii\n        $s3 = \"<guestusername>k__\" ascii\n        $s4 = \".VirtualMachineDeviceRuntimeInfoVirtualEthernetCardRuntimeState\" ascii\n        $s5 = \"datastoreUrl\" ascii\n        $s6 = \"SharpSphere.vSphere.\" ascii\n        $s7 = \"HelpText+vCenter SDK URL, i.e. https://127.0.0.1/sdk\" ascii\n        $s8 = \"[x] Execution finished, attempting to retrieve the results\" fullword wide\n        $s9 = \"C:\\\\Windows\\\\System32\\\\cmd.exe\" fullword wide\n        $s10 = \"C:\\\\Users\\\\Public\\\\\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_ExchangeExploit {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Hunt for executables potentially embedding Exchange Server exploitation artificats\"\n    strings:\n        $s1 = \"ecp/default.flt?\" ascii wide nocase\n        $s2 = \"owa/auth/logon.aspx?\" ascii wide nocase\n        $s3 = \"X-AnonResource-Backend\" ascii wide\n        $s4 = \"EWS/Exchange.asmx?\" ascii wide nocase\n        $s5 = \"X-BEResource\" ascii wide\n        $s6 = \"https://%s/owa/auth/\" ascii wide\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f) and 5 of them\n}\n\nrule INDICATOR_TOOL_GoCLR {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detects binaries utilizing Go-CLR for hosting the CLR in a Go process and using it to execute a DLL from disk or an assembly from memory\"\n    strings:\n        $s1 = \"github.com/ropnop/go-clr.(*IC\" ascii\n        $s2 = \"EnumKeyExWRegEnumValueWRegOpenKeyExWRtlCopyMemoryRtlGetVersionShellExecuteWStartServiceW\" ascii\n        $c1 = \"ICorRuntimeHost\" ascii wide\n        $c2 = \"CLRCreateInstance\" ascii wide\n        $c3 = \"ICLRRuntimeInfo\" ascii wide\n        $c4 = \"ICLRMetaHost\" ascii wide\n        $go = \"Go build ID:\" ascii wide\n    condition:\n        uint16(0) == 0x5a4d and all of ($s*) or (2 of ($c*) and $go)\n}\n\nrule INDICATOR_TOOL_EdgeCookiesView {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detects EdgeCookiesView\"\n    strings:\n        $s1 = \"AddRemarkCookiesTXT\" fullword wide\n        $s2 = \"# Netscape HTTP Cookie File\" fullword wide\n        $s3 = \"/scookiestxt\" fullword wide\n        $s4 = \"/deleteregkey\" fullword wide\n        $s5 = \"Load cookies from:\" wide\n        $s6 = \"Old cookies folder of Edge/IE\" wide\n        $pdb = \"\\\\EdgeCookiesView\\\\Release\\\\EdgeCookiesView.pdb\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (5 of ($s*) or (($pdb) and 2 of ($s*)))\n}\n\nrule INDICATOR_TOOL_SharpNoPSExec {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpNoPSExec\"\n    strings:\n        $s1 = \"|-> Service\" wide\n        $s2 = \"authenticated as\" wide\n        $s3 = \"ImpersonateLoggedOnUser failed. Error:{0}\" wide\n        $s4 = \"uPayload\" fullword ascii\n        $s5 = \"pcbBytesNeeded\" fullword ascii\n        $s6 = \"SharpNoPSExec\" ascii wide\n        $pdb1 = \"SharpNoPSExec\\\\obj\\\\Debug\\\\SharpNoPSExec.pdb\" ascii\n        $pdb2 = \"SharpNoPSExec\\\\obj\\\\Release\\\\SharpNoPSExec.pdb\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (4 of ($s*) or (1 of ($pdb*) and 1 of ($s*)))\n}\n\nrule INDICATOR_TOOL_ChromeCookiesView {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detects ChromeCookiesView\"\n    strings:\n        $s1 = \"AddRemarkCookiesTXT\" fullword wide\n        $s2 = \"Decrypt cookies\" wide\n        $s3 = \"/scookiestxt\" fullword wide\n        $s4 = \"/deleteregkey\" fullword wide\n        $s5 = \"Cookies.txt Format\" wide\n        $s6 = \"# Netscape HTTP Cookie File\" wide\n        $pdb = \"\\\\ChromeCookiesView\\\\Release\\\\ChromeCookiesView.pdb\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (5 of ($s*) or (($pdb) and 2 of ($s*)))\n}\n\nrule INDICATOR_TOOL_OwlProxy {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Hunt for OwlProxy\"\n    strings:\n        $is1 = \"call_new command: \" wide\n        $is2 = \"call_proxy cmd: \" wide\n        $is3 = \"download_file: \" wide\n        $is4 = \"cmdhttp_run\" wide\n        $is5 = \"sub_proxyhttp_run\" wide\n        $is6 = \"proxyhttp_run\" wide\n        $is7 = \"webshell_run\" wide\n        $is8 = \"/exchangetopicservices/\" fullword wide\n        $is9 = \"c:\\\\windows\\\\system32\\\\wmipd.dll\" fullword wide\n        $iu1 = \"%s://+:%d%s\" wide\n        $iu2 = \"%s://+:%d%spp/\" wide\n        $iu3 = \"%s://+:%d%spx/\" wide\n    condition:\n        uint16(0) == 0x5a4d and 6 of ($is*) or (all of ($iu*) and 2 of ($is*))\n}\n\nrule INDICATOR_TOOL_Backstab {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detect Backstab tool capable of killing antimalware protected processes by leveraging sysinternals Process Explorer (ProcExp) driver\"\n    strings:\n        $s1 = \"NtLoadDriver: %x\" fullword ascii\n        $s2 = \"POSIXLY_CORRECT\" fullword ascii\n        $s3 = \"\\\\\\\\.\\\\PROCEXP\" ascii\n        $s4 = \"ProcExpOpenProtectedProcess.DeviceIoControl: %\" ascii\n        $s5 = \"ProcExpKillHandle.DeviceIoControl\" ascii\n        $s6 = \"[%#llu] [%ws]: %ws\" fullword ascii\n        $s7 = \"D:P(A;;GA;;;SY)(A;;GRGWGX;;;BA)(A;;GR\" wide\n    condition:\n        uint16(0) == 0x5a4d and 6 of them\n}\n\nrule INDICATOR_TOOL_EXP_SharpPrintNightmare {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detect SharpPrintNightmare\"\n    strings:\n        $s1 = \"RevertToSelf() Error:\" wide\n        $s2 = \"NeverGonnaGiveYou\" wide\n        $s3 = \"\\\\Amd64\\\\UNIDRV.DLL\" wide\n        $s4 = \":\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\\" wide\n        $s5 = \"C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\old\\\\{0}\\\\{1}\" wide\n        $s6 = \"\\\\SharpPrintNightmare\\\\\" ascii\n        $s7 = { 4e 61 6d 65 09 46 75 6c 6c 54 72 75 73 74 01 }\n        $s8 = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Print\\\\PackageInstallation\\\\Windows x64\\\\DriverPackages\" wide\n        $s9 = \"ntprint.inf_amd64\" wide\n        $s10 = \"AddPrinterDriverEx\" wide\n        $s11 = \"addPrinter\" ascii\n        $s12 = \"DRIVER_INFO_2\" ascii\n        $s13 = \"APD_COPY_\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 7 of them\n}\n\nrule INDICATOR_TOOL_REC_ADFind {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detect ADFind\"\n    strings:\n        $s1 = \"\\\\AdFind\\\\AdFind\\\\AdFind.h\" ascii\n        $s2 = \"\\\\AdFind\\\\AdFind\\\\AdFind.cpp\" ascii\n        $s3 = \"\\\\AdFind\\\\Release\\\\AdFind.pdb\" ascii\n        $s4 = \"joeware_default_adfind.cf\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 2 of them\n}\n\nrule INDICATOR_TOOL_CNC_Chisel {\n     meta:\n        author = \"ditekSHen\"\n        description = \"Detect binaries using Chisel\"\n    strings:\n        $s1 = \"chisel-v\" ascii\n        $s2 = \"sendchisel-v\" ascii\n        $s3 = \"<-chiselclosedcookiedomainefenceempty\" ascii\n        $ws1 = \"Sec-WebSocket-Key\" ascii\n        $ws2 = \"Sec-WebSocket-Protocol\" ascii\n        $ws3 = \"Sec-Websocket-Version\" ascii\n        $ws4 = \"Sec-Websocket-Extensions\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (1 of ($s*) and 3 of ($ws*))\n}\n\nrule INDICATOR_TOOL_ANT_SharpEDRChecker {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect SharpEDRChecke, C# Implementation of Invoke-EDRChecker\"\n    strings:\n        $pdb1 = \"\\\\SharpEDRChecker.pdb\" fullword ascii\n        $x1 = \"EDRData\" fullword ascii\n        $x2 = \"bytesNeeded\" fullword ascii\n        $x3 = /\\] Checking (Directories|drivers|processes|modules|Registry|Services) \\[/ wide\n        $s1 = \"CheckService\" fullword ascii\n        $s2 = \"CheckModule\" fullword ascii\n        $s3 = \"PrivCheck\" fullword ascii\n        $s4 = \"ServiceChecker\" fullword ascii\n        $s5 = \"PrivilegeChecker\" fullword ascii\n        $s6 = \"FileChecker\" fullword ascii\n        $s7 = \"DriverChecker\" fullword ascii\n        $s8 = \"ProcessChecker\" fullword ascii\n        $s9 = \"DirectoryChecker\" fullword ascii\n        $s10 = \"RegistryChecker\" fullword ascii\n        $s11 = \"CheckDriver\" fullword ascii\n        $s12 = \"CheckServices\" fullword ascii\n        $s13 = \"CheckDirectories\" fullword ascii\n        $s14 = \"CheckCurrentProcessModules\" fullword ascii\n        $s15 = \"CheckProcesses\" fullword ascii\n        $s16 = \"CheckDrivers\" fullword ascii\n        $s17 = \"CheckProcess\" fullword ascii\n        $s18 = \"CheckSubDirectory\" fullword ascii\n        $s19 = \"CheckDirectory\" fullword ascii\n        $s20 = \"CheckRegistry\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or 10 of ($s*) or (1 of ($pdb*) and (1 of ($x*) or 2 of ($s*))) or (#x3 > 4 and 2 of them))\n}\n\nrule INDICATOR_TOOL_ANT_InviZzzible {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect InviZzzible\"\n    strings:\n        $s1 = \"\\\\\\\\.\\\\pipe\\\\task_sched_se\" fullword wide\n        $s2 = \"\\\\\\\\\\\\.\\\\NPF_NdisWanIp\" fullword wide\n        $s3 = /--action --(dtt|mra|user-input|cfg|dan|evt|pid|exc|wmi|tsh)/ fullword wide\n        $s4 = \"cuckoo_%lu.ini\" fullword wide\n        $s5 = \"sandbox evasion\" wide nocase\n        $s6 = \"UnbalancedStack\" fullword ascii\n        $s7 = \"process_with_long_name\" fullword ascii\n        $s8 = \"DelaysAccumulation\" fullword ascii\n        $s9 = \"PidReuse\" fullword ascii\n        $s10 = \"DeadAnalyzer\" fullword ascii\n        $s11 = \"SleepDummyPatch\" fullword ascii\n        $s12 = \"AudioDeviceAbsence\" fullword ascii\n        $s14 = \"\\\\\\\\.\\\\PhysicalDrive%u\" fullword ascii\n        $s15 = \"\\\"countermeasures\\\":\" ascii\n        $s16 = \"_%.02u%.02u%.02u_%.02u%.02u%.02u.html\" ascii\n        $f1 = \".?AVHyperV@SandboxEvasion@@\" ascii\n        $f2 = \".?AVJoebox@SandboxEvasion@@\" ascii\n        $f3 = \".?AVKVM@SandboxEvasion@@\" ascii\n        $f4 = \".?AVMisc@SandboxEvasion@@\" ascii\n        $f5 = \".?AVParallels@SandboxEvasion@@\" ascii\n        $f6 = \".?AVQEMU@SandboxEvasion@@\" ascii\n        $f7 = \".?AVSandboxie@SandboxEvasion@@\" ascii\n        $f8 = \".?AVVBOX@SandboxEvasion@@\" ascii\n        $f9 = \".?AVVirtualPC@SandboxEvasion@@\" ascii\n        $f10 = \".?AVVMWare@SandboxEvasion@@\" ascii\n        $f11 = \".?AVWine@SandboxEvasion@@\" ascii\n        $f12 = \".?AVXen@SandboxEvasion@@\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (6 of ($s*) or 4 of ($f*) or (2 of ($f*) and 2 of ($s*)))\n}\n\nrule INDICATOR_TOOL_EXFIL_SharpBox {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect SharpBox, C# tool for compressing, encrypting, and exfiltrating data to Dropbox using the Dropbox API\"\n    strings:\n        $s1 = \"UploadData\" fullword ascii\n        $s2 = \"isAttached\" fullword ascii\n        $s3 = \"DecryptFile\" fullword ascii\n        $s4 = \"set_dbxPath\" fullword ascii\n        $s5 = \"set_dbxToken\" fullword ascii\n        $s6 = \"set_decrypt\" fullword ascii\n        $s7 = \"GeneratePass\" fullword ascii\n        $s8 = \"FileUploadToDropbox\" fullword ascii\n        $s9 = \"\\\\SharpBox.pdb\" ascii\n        $s10 = \"https://content.dropboxapi.com/2/files/upload\" fullword wide\n        $s12 = \"Dropbox-API-Arg: {\\\"path\\\":\" wide\n        $s13 = \"X509Certificate [{0}] Policy Error: '{1}'\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 7 of them\n}\n\nrule INDICATOR_TOOL_EXP_SeriousSAM01 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect tool variants potentially exploiting SeriousSAM / HiveNightmare CVE-2021-36934\"\n    strings:\n        $s1 = \"VolumeShadowCopy\" fullword wide\n        $s2 = \"\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\\" fullword wide\n        $s3 = \"{0}\\\\{1}$:aad3b435b51404eeaad3b435b51404ee:{2}\" fullword wide\n        $s4 = \"ASPNET_WP_PASSWORD\" fullword wide\n        $s5 = \"<ParseSam>b__\" ascii\n        $s6 = \"<DumpSecret\" ascii\n        $s7 = \"<ParseSecret\" ascii\n        $s8 = \"LsaSecretBlob\" fullword ascii\n        $s9 = \"systemHive\" fullword ascii\n        $s10 = \"ImportHiveDump\" fullword ascii\n        $s11 = \"FindShadowVolumes\" fullword ascii\n        $s12 = \"GetBootKey\" fullword ascii\n        $r1 = \"[*] SAM\" wide\n        $r2 = \"[*] SYSTEM\" wide\n        $r3 = \"[*] SECURITY\" wide\n    condition:\n        uint16(0) == 0x5a4d and (6 of ($s*) or (all of ($r*) and 3 of ($s*)))\n}\n\nrule INDICATOR_TOOL_EXP_SeriousSAM02 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect tool variants potentially exploiting SeriousSAM / HiveNightmare CVE-2021-36934\"\n    strings:\n        $s1 = \"\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy\" fullword wide\n        $s2 = /(Windows\\\\System32\\\\config)?\\\\(SAM|SECURITY|SYSTEM)/ ascii wide\n        $s3 = /(SAM|SECURITY|SYSTEM)-%s/ fullword wide\n        $s4 = /: (SAM|SECURITY|SYSTEM) hive from/ wide\n        $v1 = \"VolumeShadowCopy\" ascii wide\n        $v2 = \"GLOBALROOT\" ascii wide\n        $v3 = \"Device\" ascii wide\n        $n1 = \"Block Level Backup Engine Service EXE\" ascii wide\n        $n2 = \"|TaskID=%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X\" wide\n        $n3 = \"[traceprovider-trace] Failed: %ws: %#010x\" wide\n        $n4 = \"base\\\\stor\\\\blb\\\\engine\\\\usn\\\\base\\\\lib\\\\usnjournalhelper.cpp\" wide\n    condition:\n        uint16(0) == 0x5a4d and not any of ($n*) and (all of ($s*) or (all of ($v*) and 2 of ($s*)) or (all of ($v*) and #s2 > 2))\n}\n\nrule INDICATOR_TOOL_EXP_PetitPotam01 {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect tool potentially exploiting/attempting PetitPotam\"\n    strings:\n        $s1 = \"\\\\pipe\\\\lsarpc\" fullword wide\n        $s2 = \"\\\\%s\" fullword wide\n        $s3 = \"ncacn_np\" fullword wide\n        $s4 = /EfsRpc(OpenFileRaw|EncryptFileSrv|DecryptFileSrv|QueryUsersOnFile|QueryRecoveryAgents|RemoveUsersFromFile|AddUsersToFile)/ wide\n        $r1 = \"RpcBindingFromStringBindingW\" fullword ascii\n        $r2 = \"RpcStringBindingComposeW\" fullword ascii\n        $r3 = \"RpcStringFreeW\" fullword ascii\n        $r4 = \"RPCRT4.dll\" fullword ascii\n        $r5 = \"NdrClientCall2\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($s*) and 4 of ($r*))\n}\n\nrule INDICATOR_TOOL_PET_SharpStrike {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect SharpStrike post-exploitation tool written in C# that uses either CIM or WMI to query remote systems\"\n    strings:\n        $x1 = \"SharpStrike v\" wide\n        $x2 = \"[*] Agent is busy\" wide\n        $x3 = \"SharpStrike_Fody\" fullword ascii\n        $s1 = \"ServiceLayer.CIM\" fullword ascii\n        $s2 = \"Models.CIM\" fullword ascii\n        $s3 = \"<HandleCommand>b__\" ascii\n        $s4 = \"MemoryStream\" fullword ascii\n        $s5 = \"GetCommands\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($x*) or all of ($s*))\n}\n\nrule INDICATOR_TOOL_LTM_Ladon {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect Ladon tool that assists in lateral movement across a network\"\n    strings:\n        $d1 = \"Ladon.VncSharp.dll\" fullword ascii\n        $d2 = \"Ladon.Renci.SshNet.dll\" fullword ascii\n        $s1 = \"Ladon.\" ascii\n        $s2 = \"nowPos\" fullword ascii\n        $s3 = \"Scan\" fullword ascii\n        $s4 = \"QLZ_STREAMING_BUFFER\" fullword ascii\n        $s5 = \"sizeDecompressed\" fullword ascii\n        $s6 = \"UpdateByte\" fullword ascii\n        $s7 = \"kNumBitPriceShiftBits\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($d*) or all of ($s*) or (1 of ($d*) and 5 of ($s*)))\n}\n\nrule INDICATOR_TOOL_LTM_LadonExp {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect Ladon tool that assists in lateral movement across a network\"\n    strings:\n        $s1 = \"txt_cscandll.Text\" fullword wide\n        $s2 = \"CscanWebExpBuild.frmMain.resources\" fullword ascii\n        $s3 = \"= \\\"$HttpXforwardedFor$\\\";\" ascii\n        $s4 = \"namespace netscan\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_LTM_LadonGo {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect LadonGo tool that assists in lateral movement across a network\"\n    strings:\n        $f1 = \"main.VulDetection\" fullword ascii\n        $f2 = \"main.BruteFor\" fullword ascii\n        $f3 = \"main.RemoteExec\" fullword ascii\n        $f4 = \"main.Exploit\" fullword ascii\n        $f5 = \"main.Noping\" fullword ascii\n        $f6 = \"main.LadonScan\" fullword ascii\n        $f7 = \"main.LadonUrlScan\" fullword ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f or uint16(0) == 0xface) and 5 of ($f*)\n}\n\nrule INDICATOR_TOOL_ENC_DiskCryptor {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect DiskCryptor open encryption solution that offers encryption of all disk partitions\"\n    strings:\n        // Executable\n        $x1 = \"\\\\DiskCryptor\\\\DCrypt\\\\\" ascii\n        $s1 = \"Error getting %sbootloader configuration\" fullword wide\n        $s2 = \"loader.iso\" fullword wide\n        $s3 = \"Bootloader config for [%s]\" fullword wide\n        $s4 = \"dc_get_mbr_config\" fullword ascii\n        $s5 = \"dc_encrypt_iso_image\" fullword ascii\n        $s6 = \"dc_start_re_encrypt\" fullword ascii\n        $s7 = \"dc_start_encrypt\" fullword ascii\n        $s8 = \"_w10_reflect_\" ascii\n        // Driver\n        $d1 = \"\\\\DosDevices\\\\dcrypt\" fullword wide\n        $d2 = \"$dcsys$_fail_%x\" fullword wide\n        $d3 = \"%s\\\\$DC_TRIM_%x$\" fullword wide\n        $d4 = \"\\\\Device\\\\dcrypt\" fullword wide\n        $d5 = \"%s\\\\$dcsys$\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and ((1 of ($x*) and 2 of ($s*)) or 4 of ($s*) or 3 of ($d*))\n}\n\nrule INDICATOR_TOOL_PRI_InstallerFileTakeOver {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect InstallerFileTakeOver CVE-2021-41379\"\n    strings:\n        $s1 = \"splwow64.exe\" fullword ascii\n        $s2 = \"notepad.exe\" fullword ascii\n        $s3 = \"%s\\\\System32\\\\cmd.exe\" fullword wide\n        $s4 = \"[SystemFolder]msiexec.exe\" fullword wide\n        $s5 = \"microsoft plz\" ascii\n        $s6 = \"%TEMP%\\\\\" fullword wide\n        $x1 = \"\\\\InstallerFileTakeOver.pdb\" ascii\n        $o1 = { 48 b8 fe ff ff ff ff ff ff 7f 48 8b f5 48 83 ce }\n        $o2 = { 4c 8d 62 10 48 c7 c7 ff ff ff ff 48 8b c7 66 0f }\n        $o3 = { ff 15 9a 59 00 00 48 8b d8 e8 ba ff ff ff 45 33 }\n        $o4 = { 49 c7 43 a8 fe ff ff ff 49 89 5b 10 48 8b 05 5a }\n        $o5 = { 66 89 7c 24 50 48 c7 c2 ff ff ff ff 48 ff c2 66 }\n    condition:\n        uint16(0) == 0x5a4d and ((1 of ($x*) and (2 of ($s*) or 3 of ($o*))) or 4 of ($s*) or (all of ($o*) and 2 of them))\n}\n\nrule INDICATOR_TOOL_PRI_JuicyPotato {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects JuicyPotato\"\n    strings:\n        $x1 = \"\\\\JuicyPotato.pdb\" ascii\n        $x2 = \"JuicyPotato v%s\" fullword ascii\n        $s1 = \"hello.stg\" fullword wide\n        $s2 = \"ppVirtualProcessorRoots\" fullword ascii\n        $s3 = \"Lock already taken\" fullword ascii\n        $s4 = \"[+] authresult %d\" fullword ascii\n        $s5 = \"RPC -> send failed with error: %d\" fullword ascii\n        $s6 = \"Priv Adjust FALSE\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 3 of ($s*)) or (5 of ($s*)))\n}\n\nrule INDICATOR_TOOL_PWS_LSASS_NanoDump {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects NanoDump tool that creates a minidump of the LSASS process\"\n    strings:\n        $s1 = \"\\\\Registry\\\\Machine\\\\Software\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\LocalDumps\\\\\" fullword wide\n        $s2 = \"\\\\Registry\\\\Machine\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit\\\\\" fullword wide\n        $s3 = \"DumpType\" fullword wide\n        $s4 = \"LocalDumpFolder\" fullword wide\n        $s5 = \"\\\\??\\\\C:\\\\Windows\\\\System32\\\\seclogon.dll\" fullword wide\n        $s6 = \"minidump %s\" ascii\n        $s7 = \"--seclogon-\" ascii\n        $s8 = \"shtinkering\" ascii\n        $s9 = \"LSASS PID: %ld\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_ENUM_SharpShares {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpShares multithreaded C# .NET Assembly to enumerate accessible network shares in a domain\"\n    strings:\n        $s1 = \"SharpShares.\" ascii wide\n        $s2 = \"GetComputerShares\" fullword ascii\n        $s3 = \"userAccountControl:1.2.840.113556.1.4.803:=2))(operatingSystem=*server*)(!(userAccountControl:1.2\" wide\n        $s4 = \"GetAllShares\" fullword ascii\n        $s5 = \"stealth:\" wide\n        $s6 = \"(&(objectCategory=computer)(!(userAccountControl:1.2.840.113556.1.4.803:=2))(operatingSystem=*server*))\" fullword wide\n        $s7 = /\\/targets|ldap|threads/ wide\n        $s8 = \"entriesread\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_PROX_revsocks {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects revsocks Reverse socks5 tunneler with SSL/TLS and proxy support\"\n    strings:\n        $s1 = \"main.agentpassword\" fullword ascii \n        $s2 = \"main.connectForSocks\" fullword ascii \n        $s3 = \"main.connectviaproxy\" fullword ascii \n        $s4 = \"main.DnsConnectSocks\" fullword ascii \n        $s5 = \"main.listenForAgents\" fullword ascii \n        $s6 = \"main.listenForClients\" fullword ascii\n        $s7 = \"main.getPEMs\" fullword ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f) and 4 of them\n}\n\nrule INDICATOR_TOOL_PWS_azbelt {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects azbelt for enumerating Azure related credentials primarily on AAD joined machines\"\n    strings:\n        $s1 = \"@http://169.254.169.254/metadata/identity/oauth2/token?api-version=\" ascii\n        $s2 = \"@Partner Customer Delegated Admin Offline Processor\" fullword ascii\n        $s3 = \"@TargetName: \" fullword ascii\n        $s4 = \"httpclient.nim\" fullword ascii\n        $s5 = \"@DSREG_DEVICE_JOIN\" fullword ascii\n        $s6 = \"@.azure/msal_token_cache.bin\" fullword ascii\n        $s7 = \"CredEnumerateW\" fullword ascii\n        $s8 = \"@http://169.254.169.254/metadata/instance?api-version=\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 6 of them\n}\n\nrule INDICATOR_TOOL_DontSleep {\n     meta:\n        author = \"ditekShen\"\n        description = \"Detects Keep Host Unlocked (Don't Sleep)\"\n    strings:\n        $s1 = \":Repeat###DEL \\\"%s\\\"###if exist \\\"%s\\\" goto Repeat###DEL \\\"%s\\\"###\" wide\n        $s2 = \"powrprof.dll,SetSuspendState\" wide\n        $s3 = \"_selfdestruct.bat\" wide\n        $s4 = \"please_sleep_block_\" ascii\n        $s5 = \"Browser-Type: MiniBowserOK\" wide\n        $s6 = \"m_use_all_rule_no_sleep\" ascii\n        $s7 = \"BlockbyExecutionState: %d on:%d by_enable:%d\" fullword wide\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_NSudo {\n     meta:\n        author = \"ditekShen\"\n        description = \"Detects NSudo allowing to run processes as TrustedInstaller or System\"\n    strings:\n        $x1 = \"cmd /c start \\\"NSudo.\" wide\n        $x2 = \"*\\\\shell\\\\NSudo\" fullword wide\n        $x3 = \"Projects\\\\NSudo\\\\Output\\\\Release\\\\x64\\\\NSudo.pdb\" ascii\n        $s1 = \"-ShowWindowMode=Hide\" wide\n        $s2 = \"?what@exception@@UEBAPEBDXZ\" fullword ascii\n        $s3 = \"NSudo.RunAs.\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (2 of ($x*) or (1 of ($x*) and 2 of ($s*)) or all of ($s*) or 4 of them)\n}\n\nrule INDICATOR_TOOL_Ligolo {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Ligolo tool for establishing SOCKS5 or TCP tunnels from a reverse connection\"\n    strings:\n        $p1 = \"/ligolo/main.go\" ascii\n        $p2 = \"/armon/go-socks5\" ascii\n        $s1 = \"main.StartLigolo\" fullword ascii\n        $s2 = \"main.handleRelay\" fullword ascii\n        $s3 = \"main.startSocksProxy\" fullword ascii\n        $s4 = \"_main.tlsFingerprint\" fullword ascii\n        $s5 = \"main.verifyTlsCertificate\" fullword ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f or uint16(0) == 0xfacf) and ((all of ($p*) and 1 of ($s*)) or all of ($s*) or (1 of ($p*) and 4 of ($s*)))\n}\n\nrule INDICATOR_TOOL_ExtPassword {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects ExtPassword External Drive Password Recovery\"\n    strings:\n        $x1 = \"ExtPassword!\" fullword wide\n        $s2 = \"GReading Chrome password file: %s\" fullword wide\n        $s3 = \"\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy%d\" fullword wide\n        $s4 = \"2015-07-27 13:49:41 b8e92227a469de677a66da62e4361f099c0b79d0\" ascii\n        $s5 = \"metadata WHERE id = 'password'\" ascii\n        $s6 = /Scanning\\s(Credentials\\sfolder|Credentials\\sfolder|Firefox\\sand\\sother\\sMozilla\\sWeb\\sbrowsers|Chromium-based\\Web\\browsers|Outlook\\saccounts|Windows\\sVault|dialup\\/VPN\\sitems|wireless\\skeys|Windows\\ssecurity\\squestions|vault\\spasswords)/ wide\n        $s7 = \"lhelp32Snapsho\" fullword ascii\n        $s8 = \"SELECT origin_\" fullword ascii\n        $s9 = \"password#Ck\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and (1 of ($x*) and 3 of ($s*)) or 6 of ($s*)\n}\n\nrule INDICATOR_TOOL_Ngrok {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Ngrok\"\n    strings:\n        $s1 = \"dashboard.ngrok.com\" ascii\n        $s2 = \"go.ngrok.com/cmd/ngrok/main.go\" ascii\n        $s3 = \"ngrok agent\" ascii\n        $s4 = \"*ngrok.clientInfo\" ascii\n        $s5 = \"'%s'  socket: '%s'  port: %d/edges/https/{{ .EdgeID }}/routes/{{ .ID }}/webhook_\" ascii\n        $s6 = \"/{{ .ID }}/tunnel_sessions/{{ .ID }}/restart\" ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f or uint16(0) == 0xfacf) and (3 of them)\n}\n\nrule INDICATOR_TOOL_SQLRecon {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SQLRecon C# MS-SQL toolkit designed for offensive reconnaissance and post-exploitation\"\n    strings:\n        $s1 = \"ConvertDLLToSQLBytes\" ascii\n        $s2 = \"\\\\SQLRecon.pdb\" ascii\n        $s3 = \"GetAllSQLServerInfo\" ascii\n        $s4 = \"<GetMSSQLSPNs>b__\" ascii\n        $s5 = \"select 1; exec master..xp_cmdshell\" wide\n        $s6 = \"-> Command Execution\" wide\n        $s7 = \";EXEC dbo.sp_add_jobstep @job_name =\" wide\n        $s8 = \"EXEC sp_drop_trusted_assembly 0x\" wide\n        $s9 = \"(&(sAMAccountType=805306368)(servicePrincipalName=MSSQL*))\" wide\n    condition:\n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_AtlasReaper {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects AtlasReaper command-line tool for Confluence and Jira reconnaissance, credential farming and social engineering\"\n    strings:\n        $s1 = \"/((?:A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16})/\" fullword wide\n        $s2 = \"/rest/api/3/search?jql=\" fullword wide\n        $s3 = \"attachments+IS+NOT+EMPTY&fields=attachment,summary,status\" fullword wide\n        $s4 = \"<ParseJira>b__\" ascii\n        $s5 = \"<Atlas_Doc_Format>k__\" ascii\n        $s6 = \"<ParseConfluence>b__\" ascii\n        $s7 = \"AtlasReaper_ProcessedByFody\" fullword ascii\n        $s8 = /AtlasReaper\\.(Jira|Confluence)/ fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_NgrokSharp {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects NgrokSharp .NET library for Ngrok\"\n    strings:\n        $x1 = \"NgrokSharp\" fullword wide\n        $x2 = \"/entvex/NgrokSharp\" ascii\n        $s1 = \"start --none -region\" wide\n        $s2 = \"startTunnelDto\" fullword wide\n        $s3 = \"/tunnels/\" fullword wide\n        $s4 = \"<StartNgrok\" ascii\n        $s5 = \"INgrokManager\" ascii\n        $s6 = \"_tunnel_name\"ascii\n        $s7 = \"_ngrokDownloadUrl\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 3 of ($s*)) or 4 of ($*))\n}\n\nrule INDICATOR_TOOL_NgrokGo {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Go implementation variant for Ngrok\"\n    strings:\n        $s1 = \"/codegangsta/inject\" fullword wide\n        $s2 = \"go.ngrok.com/\" ascii\n        $s3 = \"GetIsNgrokDomain\" ascii\n        $s4 = \"GetNgrokMetering\" ascii\n        $s5 = \"*cli.ngrokService\" ascii\n        $s6 = \"GetAllowNgrokLink\" ascii\n        $s7 = \"ngrok {{.Name}}{{if .Flags}}\" ascii\n        $s8 = \"github.com/nikolay-ngrok/\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_Tool_Forensia {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Forensia anti-forensics tool used for erasing footprints\"\n    strings:\n        $c1 = \"for /F \\\"tokens=*\\\" %1 in ('wevtutil.exe el') DO wevtutil.exe cl \\\"%1\\\"\" ascii\n        $c2 = \"del /F /Q C:\\\\Windows\\\\Prefetch\\\\*\" ascii\n        $c3 = \"del C:\\\\Windows\\\\AppCompat\\\\Programs\\\\RecentFileCache.bcf\" ascii\n        $c4 = \"del /F /Q %APPDATA%\\\\Microsoft\\\\Windows\\\\Recent\\\\*\" ascii\n        $c5 = \"del /F /Q %APPDATA%\\\\Microsoft\\\\Windows\\\\Recent\\\\CustomDestinations\\\\*\" ascii\n        $c6 = \"del /F /Q %APPDATA%\\\\Microsoft\\\\Windows\\\\Recent\\\\AutomaticDestinations\\\\*\" ascii\n        $c7 = \"fsutil.exe usn deletejournal /D C:\" ascii\n        $r1 = \"\\\\Memory Management\\\\PrefetchParameters\" wide\n        $r2 = \"\\\\Explorer\\\\Advanced\" wide\n        $r3 = \"\\\\Services\\\\EventLog\" wide\n        $r4 = \"\\\\Shell\\\\BagMRU\" wide\n        $r5 = \"\\\\Control\\\\FileSystem\" wide\n        $r6 = \"\\\\Setup\\\\VC\" wide\n        $s1 = \"[LOG] - %s\" wide\n        $s2 = \"\\\\forensia\\\\regedit.hpp\" wide\n        $s3 = \"NtfsDisableLastAccessUpdate\" wide\n        $s4 = \"Melting The Executable\" wide\n        $s5 = \"Sysmon Unloader\" wide\n        $s6 = \"Rundll32.exe apphelp.dll,ShimFlushCache\" ascii\n        $s7 = \"\\\\Debug\\\\forensia.pdb\" ascii\n        $s8 = { 55 00 00 00 aa 00 00 00 92 49 24 00 49 24 92 00\n                24 92 49 00 00 00 00 00 11 00 00 00 22 00 00 00\n                33 00 00 00 44 00 00 00 66 00 00 00 88 00 00 00\n                99 00 00 00 bb 00 00 00 cc 00 00 00 dd 00 00 00\n                ee 00 00 00 ff 00 00 00 6d b6 db 00 b6 db 6d 00\n                db 6d b6 }\n    condition:\n        uint16(0) == 0x5a4d and ((4 of ($c*) and 2 of ($r*)) or (4 of ($r*) and 2 of ($c*)) or 6 of ($s*) or (3 of ($s*) and 2 of ($r*) and 1 of ($c*)))\n}\n\nrule INDICATOR_TOOL_DWAgentLIB {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect DWAgent Remote Administration Tool library\"\n    strings:\n        $s1 = \"DWAgentLib\" fullword wide\n        $s2 = \"PYTHONHOME\" fullword wide\n        $s3 = \"isTaskRunning\" fullword ascii\n        $s4 = \"isUserInAdminGroup\" fullword ascii\n        $s5 = \"setFilePermissionEveryone\" fullword ascii\n        $s6 = \"startProcessInActiveConsole\" fullword ascii\n        $s7 = \"taskKill\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_DWAgentSVC {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect DWAgent Remote Administration Tool service\"\n    strings:\n        $s1 = \"\\\\native\\\\dwagupd.dll\" wide\n        $s2 = \"\\\\native\\\\dwagsvc.exe\\\" run\" wide\n        $s3 = \"CreateServiceW\" fullword ascii\n        $s4 = /dwagent\\.(pid|start|stop)/ wide\n        $s5 = \"Check updating...\" wide\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_DWAgent_ScreenCapture {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect DWAgent Remote Administration Tool Screen Capture Module\"\n    strings:\n        $s1 = \"DWAgentLib\" fullword wide\n        $s2 = \"PYTHONHOME\" wide\n        $s3 = \"VirtualBox\" wide\n        $s4 = \"VMware\" wide\n        $s5 = \"ScreenCapture::prepareCursor#\" ascii\n        $s6 = \"ScreenCapture::getMonitorCount#\" ascii\n        $s7 = \"ScreenCapture::token\" ascii\n        $s8 = \"dwascreencapture\" ascii\n        $s9 = \"inputKeyboard CTRLALTCANC\" ascii\n        $s10 = \"_Z34ScreenCaptureNativeMonitorEnumProc\" ascii\n        $s11 = \"_Z41ScreenCaptureNativeCreateWindowThreadProc\" ascii\n        $s12 = \"_ZN13ScreenCapture\" ascii\n        $s13 = \"isUserInAdminGroup\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 7 of them\n}\n\nrule INDICATOR_TOOL_DWAgent_SoundCapture {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detect DWAgent Remote Administration Tool Sound Capture Module\"\n    strings:\n        $s1 = \"DWASoundCapture\" ascii\n        $s2 = /_Z\\d{2}DWASoundCapture/ ascii\n        $s3 = \"_Z6recordPvS_\" ascii\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_CelestyBinderLoader {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Celesty Binder loader\"\n    strings:\n        $s1 = \"\\\\DarkCoderSc\\\\Desktop\\\\Celesty Binder\\\\Stub\\\\STATIC\\\\Stub.pdb\" ascii\n        $s2 = \"DROPIN\" fullword ascii wide\n        $s3 = \"EXEC\" fullword ascii wide\n        $s4 = \"RBIND\" fullword ascii wide\n        $s5 = \"%LAPPDATA%\" fullword ascii wide\n        $s6 = \"%USERDIR%\" fullword ascii wide\n    condition:\n        uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_DogzProxy {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Dogz proxy tool\"\n    strings:\n        $s1 = \"LOGONSERVER=\" fullword wide\n        $s2 = \"DOGZ_E_\" ascii\n        $s3 = \"got handshake_id=%d\" ascii\n        $s4 = \"responser send connect ack\" ascii\n        $s5 = \"dogz \" ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_FastReverseProxy {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Fast Reverse Proxy (FRP) tool\"\n    strings:\n        $x1 = \"<title>frp client admin UI</title>\" ascii\n        $x2 = \"https://github.com/fatedier/frp\" ascii\n        $s1 = \").SetLogin\" ascii\n        $s2 = \").SetPing\" ascii\n        $s3 = \").SetNewWorkConn\" ascii\n        $s4 = \").ServeHTTP\" ascii\n        $s5 = \").Middleware\" ascii\n        $s6 = \"frpc proxy config error:\" ascii\n        $s7 = \"frpc sudp visitor proxy is close\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 4 of ($s*)) or (all of ($s*)))\n}\n\nrule INDICATOR_TOOL_GoGoScan {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects GoGo scan tool\"\n    strings:\n        $s1 = \"(conn) (scan  (scan) MB in  Value>\" ascii\n        $s2 = \"sweep sysmontargettelnet\" ascii\n        $s3 = \"%d bytes(?i) (.*SESS.*?ID)([a-z0-9])([A-Z]+)\" ascii\n        $s4 = \"prepareForSweep\" ascii\n        $s5 = \"Scanned %s with %d ports, found %d\" ascii\n        $s6 = \"/chainreactors/gogo/\" ascii\n        $s7 = \"Starting task %s ,total ports: %d , mod: %s\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 6 of them\n}\n\nrule INDICATOR_TOOL_GoGoProcDump {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects GoGo (lsass) process dump tool\"\n    strings:\n        $s1 = \"C:\\\\temp\" ascii\n        $s2 = \"gogo\" fullword ascii\n        $s3 = \"/DumpLsass-master/SilentProcessExit/\" ascii\n        $s4 = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Time Zone\" ascii\n        $s5 = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit\\\\lsass.exe\" ascii\n        $s6 = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\lsass.exe\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_FScan {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects GoGo scan tool\"\n    strings:\n        $s1 = \"fscan version:\" ascii\n        $s2 = \"Citrix-ConfProxyCitrix-MetaframeCitrix-NetScalerCitrix-XenServerCitrix_Netscaler\" ascii\n        $s3 = \"(AkamaiGHost)(DESCRIPTION=(Typecho</a>)(^.+)([0-9]+)(confluence.)(dotDefender)\" ascii\n        $s4 = \"/fscan/\" ascii\n        $s5 = \"WebScan.CheckDatas\" ascii\n        $s6 = \"'Exploit.Test\" ascii\n        $s7 = \"rules:\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_BURTNCIGAR {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects BURNTCIGAR a utility which terminates processes associated with endpoint security software\"\n    strings:\n        $s1 = \"Kill PID =\" ascii\n        $s2 = \"CreateFile Error =\" ascii\n        $s3 = \"\\\\KillAV\" ascii\n        $s4 = \"DeviceIoControl\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_WEDGECUT {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects WEDGECUT a reconnaissance tool to checks hosts are online using ICMP packets\"\n    strings:\n        $s1 = \"-name\" fullword ascii\n        $s2 = \"-full\" fullword ascii\n        $s3 = \"\\\\CheckOnline\" ascii\n        $s4 = \"IcmpSendEcho\" fullword ascii\n        $s5 = \"IcmpCloseHandle\" fullword ascii\n        $s6 = \"IcmpCreateFile\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and 4 of them\n}\n\nrule INDICATOR_TOOL_PPLBLade {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects PPLBlade Protected Process Dumper Tool that support obfuscating memory dump and transferring it on remote workstations without dropping it onto the disk\"\n    strings:\n        $x1 = \"PPLBlade\" ascii\n        $x2 = \"/PPLBlade/\" ascii\n        $x3 = \"PPLBlade.exe --mode\" ascii\n        $x4 = \"PPLBLADE.SYSPPLBlade.dmp\" ascii\n        $s1 = \"Dump bytes sent at %s:%d. Protocol: %s\" ascii\n        $s2 = \"Deobfuscated dump saved in file %s\" ascii\n        $m1 = \"main.WriteDriverOnDisk\" ascii\n        $m2 = \"main.ProcExpOpenProc\" ascii\n        $m3 = \"main.miniDumpCallback\" ascii\n        $m4 = \"main.copyDumpBytes\" ascii\n        $m5 = \"main.MiniDumpGetBytes\" ascii\n        $m6 = \"main.SendBytesRaw\" ascii\n        $m7 = \"main.SendBytesSMB\" ascii\n        $m8 = \"main.DeobfuscateDump\" ascii\n        $m9 = \"main.dumpMutex\" ascii\n        $m10 = \"main.dbghelpDLL\" ascii\n        $m11 = \"main.miniDumpWriteDump\" ascii\n    condition:\n        uint16(0) == 0x5a4d and (3 of ($x*) or (1 of ($x*) and (1 of ($s*) or 3 of ($m*))) or (all of ($s*) and 3 of ($m*)) or (7 of ($m*)))\n}\n\nrule INDICATOR_TOOL_SharpLDAP {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpLDAP tool written in C# that aims to do enumeration via LDAP queries\"\n    strings:\n        $x1 = \"SharpLDAP\" ascii wide\n        $x2 = \"SharpLDAP.pdb\" ascii\n        $s1 = \"(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\" wide\n        $s2 = \"(&(servicePrincipalName=*))\" wide\n        $s3 = \"/Enumerating (Domain|Enterprise|Organizational|Service|Members|Users|Computers)/\" wide\n        $s4 = \"ListMembers\" fullword ascii\n        $s5 = \"GroupMembers\" fullword ascii\n        $s6 = \"get_SamAccountName\" fullword ascii\n    condition:\n        uint16(0) == 0x5a4d and ((1 of ($x*) and 4 of ($s*)) or (5 of ($s*)))\n}\n\nrule INDICATOR_TOOL_Pandora {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Pandora tool to extract credentials from password managers\"\n    strings:\n        $s1 = \"process PID:\" fullword wide\n        $s2 = \"Dump file created:\" fullword wide\n        $s3 = \"System.Security.AccessControl.FileSystemAccessRule('Everyone', 'FullControl', 'Allow')\" ascii\n        $s4 = \"{[math]::Round($_.PrivateMemorySize64\" ascii\n        $s5 = \"rundll32.exe C:\\\\Windows\\\\System32\\\\comsvcs.dll, MiniDump $\" ascii\n        $s6 = \"\\\"payload\\\":{\\\"logins\\\":\" ascii\n        $s7 = \"\\\\pandora.pdb\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_Havoc {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects Havoc Demon\"\n    strings:\n        $x1 = \"X-Havoc:\" wide\n        $x2 = \"X-Havoc-Agent:\" wide\n        $s1 = \"\\\\Werfault.exe\" wide\n        $s2 = \"/funny_cat.gif\" wide\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or 3 of them or\n            (\n                pe.number_of_imports == 0 and \n                pe.number_of_exports == 0 and \n                2 of them\n            ) \n        )\n}\n\nrule INDICATOR_TOOLS_LocalPotato {\n    meta:\n        author = \"ditekShen\"\n        description = \"Detects LocalPotato\"\n    strings:\n       $x1 = \"LocalPotato.stg\" fullword wide\n       $x2 = \"we always love potatoes\" fullword ascii\n       $s1 = \"{00000306-0000-0000-c000-000000000046}\" wide\n       $s2 = \"{854A20FB-2D44-457D-992F-EF13785D2B51}\" wide\n       $s3 = \"cifs/127.0.0.1\" wide\n       $s4 = \"\\\\\\\\127.0.0.1\\\\c$\" wide\n       $s5 = \"complete failed: 0x%08x\" ascii\n       $s6 = \"Authorization: NTLM %s\" ascii\n       $s7 = \"Objref Moniker Display Name = %S\" ascii\n       $s8 = \"SMB Connect Tree: %S\" ascii\n       $s9 = \"b64type=%s\" fullword ascii\n       $s10 = \"decodes=%s\" fullword ascii\n       $s11 = { 53 4d 42 72 00 00 00 00 18 01 48 00 00 00 00 00\n               00 00 00 00 00 00 00 ff ff ac 7b 00 00 00 00 00\n               22 00 02 4e 54 20 4c 4d 20 30 2e 31 32 00 02 53\n               4d 42 20 32 2e 30 30 32 00 02 53 4d 42 20 32 2e\n               3f 3f 3f 00 00 00 00 00 00 00 00 00 00 00 68 fe\n               53 4d 42 40 }\n       $o1 = { 44 8b 4c 24 34 48 8d 44 24 38 48 89 44 24 28 4c }\n       $o2 = { e8 c4 ff ff ff 33 d2 48 8d 4d f0 41 b8 d0 04 00 }\n       $o3 = { 83 7b 0c 00 75 42 8b 03 25 ff ff ff 1f 3d 21 05 }\n       $o4 = { 3c 68 74 6c 3c 6a 74 5c 3c 6c 74 34 3c 74 74 24 }\n       $o5 = { e9 39 ff ff ff cc 48 89 5c 24 08 4c 89 4c 24 20 }\n       $o6 = { 48 b9 ff ff ff ff ff ff 0f 00 48 8b c2 41 b8 0c }\n    condition:\n        uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 5 of ($s*)) or 8 of($s*) or (4 of ($o*) and (1 of ($x*) or 5 of ($s*))))\n}\n\nrule INDICATOR_TOOLS_EDRSandBlast {\n    meta:\n        author = \"ditekShen\"\n        description = \"Detects EDRSandBlast\"\n    strings:\n        $s1 = \"credguard\" fullword wide\n        $s2 = \"\\\\cmd.exe\" fullword wide\n        $s3 = \"ci_%s.dll\" fullword wide\n        $s4 = \"cmd /c sc\" wide\n        $s5 = \"fltmgr_%s.sys\" fullword wide\n        $s6 = \"ntoskrnl_%s.exe\" fullword wide\n        $s7 = \"ProductDir\" fullword wide\n        $s8 = \"lsass.exe\" fullword wide\n        $s9 = \"0x%p;%ws;%ws;;;\" ascii\n        $s10 = \"MiniDumpWriteDump\" ascii\n        $s11 = \"EDRSB_Init: %u\" ascii\n        $s12 = \"ntoskrnloffsets.csv\" fullword wide nocase\n        $s13 = \"wdigestoffsets.csv\" fullword wide nocase\n        $o1 = { eb 0e 8b 85 34 15 00 00 ff c0 89 85 34 15 00 00 }\n        $o2 = { 74 48 8b 85 34 15 00 00 41 b9 04 01 00 00 4c 8d }\n    condition:\n        uint16(0) == 0x5a4d and 7 of them\n}\n\nrule INDICATOR_TOOLS_rsockstun {\n    meta:\n        author = \"ditekShen\"\n        description = \"Detects rsockstun\"\n    strings:\n        $s1 = \"main.connectviaproxy\" ascii\n        $s2 = \"main.connectForSocks\" ascii\n        $s3 = \"main.listenForClients\" ascii\n        $s4 = \"main.listenForSocks\" ascii\n        $s5 = \"Proxy-Authorization: NTLM TlRMTVNTUAABAAAABoIIAAAAAAAAAAAAAAAAAAAAAAA=\" ascii\n    condition:\n        (uint16(0) == 0x5a4d or uint16(0) == 0x457f) and all of them\n}\n\nrule INDICATOR_TOOL_SCMalDevInj_Go {\n   meta:\n        author = \"ditekShen\"\n        description = \"Detects golang shell/malware dev injector\"\n    strings:\n        $s1 = \"hooka/shellcode.go\" ascii\n        $s2 = \"/maldev\\x09v\" ascii\n        $s3 = \"Binject/debug/pe.\" ascii\n    condition:\n       uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_ReverseSSH_Go {\n   meta:\n        author = \"ditekShen\"\n        description = \"Detects golang reverse ssh tool\"\n    strings:\n        $s1 = \"/reverse_ssh/\" ascii\n        $s2 = \"main.rsshService\" ascii\n    condition:\n       uint16(0) == 0x5a4d and all of them\n}\n\nrule INDICATOR_TOOL_SharpGhostTask {\n    meta:\n        author = \"ditekSHen\"\n        description = \"Detects SharpGhostTask\"\n    strings:\n        $x1 = \"Ghosted\" wide\n        $x2 = /--target(binary|task)/ fullword wide\n        $x3 = \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\T\" wide nocase\n        $s4 = \"__GhostTask|\" ascii\n    condition:\n        uint16(0) == 0x5a4d and 3 of them\n}\n\nrule INDICATOR_TOOL_KrbRelay {\n    meta:\n        author = \"ditekshen\"\n        description = \"Detects KrbRelay\"\n    strings:\n        $s1 = \"System.Collections.Generic.IEnumerable<System.IntPtr>.GetEnumerator\" fullword ascii\n        $s2 = \"System.Collections.Generic.IEnumerator<System.IntPtr>.get_Current\" fullword ascii\n        $s3 = \"GetProcessIdFromIPid\" fullword ascii\n        $g1 = \"hello.stg\" fullword wide\n        $g2 = \"DSInternals.Common\" fullword ascii\n        $g3 = \"C:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\ntprint.inf_amd64_7b3eed059f4c3e41\\\\Amd64\\\\UNIDRV.DLL\" fullword wide\n        $g4 = \"C:\\\\Windows\\\\System32\\\\kernelbase.dll\" fullword wide\n        $g5 = \"get_UnsupportedSecretEncryptionType\" fullword ascii\n        $g6 = \"CoInitializeSecurity Error: 0x{0:X8}. Exploit will fail.\" fullword wide\n        $g7 = \"AuthnSvc: {0} - PrincName: {1}\" fullword wide\n    condition: \n        uint16(0) == 0x5a4d and ((all of ($s*) and 4 of ($g*)) or (7 of them))\n}\n\nrule INDICATOR_TOOL_EDRSilencer {\n    meta:\n        author = \"ditekshen\"\n        description = \"Detects EDRSilencer\"\n    strings:\n        $s1 = \"block \\\"C:\\\\Windows\\\\System32\\\\curl.exe\\\"\" ascii\n        $s2 = \"blockedr\" fullword ascii\n        $s3 = \"edrProcess\" fullword ascii\n        $s4 = \"BlockEdrProcessTraffic\" fullword ascii\n        $s5 = \"isInEdrProcessList\" fullword ascii\n        $s6 = \"EDRSilencer.c\" fullword ascii\n        $v1 = \"elastic-agent.exe\" fullword ascii nocase\n        $v2 = \"CybereasonAV.exe\" fullword ascii nocase\n        $v3 = \"SentinelAgent.exe\" fullword ascii nocase\n        $v4 = \"fortiedr.exe\" fullword ascii nocase\n        $v5 = \"MsMpEng.exe\" fullword ascii nocase\n        $v6 = \"CylanceSvc.exe\" fullword ascii nocase\n    condition: \n        uint16(0) == 0x5a4d and (4 of ($s*) or (3 of ($s*) and 1 of ($v*)))\n}\n\nrule INDICATOR_TOOL_EDRPrison {\n    meta:\n        author = \"ditekshen\"\n        description = \"Detects EDRPrison\"\n    strings:\n        $s1 = \"Block:\" wide\n        $s2 = \"PacketLen:\" wide\n        $s3 = \"DoWorkPacket_Step\" ascii\n        $s4 = \"DoWorkAsyncNETWORK\" ascii\n        $s5 = \"BlockMessage\" ascii\n        $s6 = \"GetRmAddrPortNetwork\" ascii\n    condition: \n        uint16(0) == 0x5a4d and 5 of them\n}\n\nrule INDICATOR_TOOL_SharpSQLPwn {\n    meta:\n        author = \"ditekshen\"\n        description = \"Detects SharpSQLPwn\"\n    strings:\n        $s1 = \"smb_ip\" fullword ascii\n        $s2 = \"Recon\" fullword ascii\n        $s3 = \"UNCPathInjection\" fullword ascii\n        $s4 = \"from sys.server_principals\" wide\n        $s5 = \"EXEC sp_configure '\" wide\n        $s6 = \"EXEC ('sp_configure\" wide\n        $s7 = \"CREATE ASSEMBLY\" wide\n        $s8 = \"DROP ASSEMBLY\" wide\n        $s9 = \"FROM 0x\" wide\n        $s10 = \"EXEC master..xp_dirtree \\\"\\\\\\\\\" wide\n    condition: \n        uint16(0) == 0x5a4d and 7 of them\n}\n\nrule INDICATOR_TOOL_ChromeKatz {\n    meta:\n        author = \"ditekshen\"\n        description = \"Detects ChromeKatz: CookieKatz and CredentialKatz\"\n    strings:\n        $s1 = \"\\\\include\\\\xmemory\" ascii wide\n        $s2 = \"targetBrowser\" ascii\n        $s3 = \"thirdPattern\" ascii\n        $s4 = \"isBrowserWow64\" ascii\n        $s5 = \"wcscpy_s(memory, size_in_elements, string)\" fullword wide\n        $s6 = \"hChrome\" fullword ascii\n        $t1 = \"szCookieMonster\" fullword ascii\n        $t2 = \"szPasswordReuseDetectorInstances\" fullword ascii\n    condition: \n        uint16(0) == 0x5a4d and 6 of them\n}\n",
    "uploadedBy": "f0b33c9c-0019-4046-984b-f6f3d95dea61",
    "category": "yar",
    "uploadedAt": "2025-05-07T09:54:43.603Z",
    "status": "active"
}