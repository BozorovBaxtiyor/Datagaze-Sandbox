{
    "name": "Maldoc_PDF.yar",
    "rule": "/*\n    This Yara ruleset is under the GNU-GPLv2 license (http://www.gnu.org/licenses/gpl-2.0.html) and open to any user or organization, as    long as you use it under this license.\n\n*/\n\nrule malicious_author : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 5\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\n\t\t$reg0 = /Creator.?\\(yen vaw\\)/\n\t\t$reg1 = /Title.?\\(who cis\\)/\n\t\t$reg2 = /Author.?\\(ser pes\\)/\n\tcondition:\n\t\t$magic in (0..1024) and all of ($reg*)\n}\n\nrule suspicious_version : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 3\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$ver = /%PDF-1.\\d{1}/\n\tcondition:\n\t\t$magic in (0..1024) and not $ver\n}\n\nrule suspicious_creation : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 2\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$header = /%PDF-1\\.(3|4|6)/\n\n\t\t$create0 = /CreationDate \\(D:20101015142358\\)/\n\t\t$create1 = /CreationDate \\(2008312053854\\)/\n\tcondition:\n\t\t$magic in (0..1024) and $header and 1 of ($create*)\n}\n\nrule multiple_filtering : PDF raw\n{\nmeta:\nauthor = \"Glenn Edwards (@hiddenillusion)\"\nversion = \"0.2\"\nweight = 3\n\n    strings:\n            $magic = { 25 50 44 46 }\n            $attrib = /\\/Filter.{,1024}(\\/ASCIIHexDecode\\W+|\\/LZWDecode\\W+|\\/ASCII85Decode\\W+|\\/FlateDecode\\W+|\\/RunLengthDecode){2}/\n            // left out: /CCITTFaxDecode, JBIG2Decode, DCTDecode, JPXDecode, Crypt\n\n    condition:\n            $magic in (0..1024) and $attrib\n}\n\nrule suspicious_title : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 4\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$header = /%PDF-1\\.(3|4|6)/\n\n\t\t$title0 = \"who cis\"\n\t\t$title1 = \"P66N7FF\"\n\t\t$title2 = \"Fohcirya\"\n\tcondition:\n\t\t$magic in (0..1024) and $header and 1 of ($title*)\n}\n\nrule suspicious_author : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 4\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$header = /%PDF-1\\.(3|4|6)/\n\n\t\t$author0 = \"Ubzg1QUbzuzgUbRjvcUb14RjUb1\"\n\t\t$author1 = \"ser pes\"\n\t\t$author2 = \"Miekiemoes\"\n\t\t$author3 = \"Nsarkolke\"\n\tcondition:\n\t\t$magic in (0..1024) and $header and 1 of ($author*)\n}\n\nrule suspicious_producer : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 2\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$header = /%PDF-1\\.(3|4|6)/\n\n\t\t$producer0 = /Producer \\(Scribus PDF Library/\n\t\t$producer1 = \"Notepad\"\n\tcondition:\n\t\t$magic in (0..1024) and $header and 1 of ($producer*)\n}\n\nrule suspicious_creator : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 3\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$header = /%PDF-1\\.(3|4|6)/\n\n\t\t$creator0 = \"yen vaw\"\n\t\t$creator1 = \"Scribus\"\n\t\t$creator2 = \"Viraciregavi\"\n\tcondition:\n\t\t$magic in (0..1024) and $header and 1 of ($creator*)\n}\n\nrule possible_exploit : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 3\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\n\t\t$attrib0 = /\\/JavaScript /\n\t\t$attrib3 = /\\/ASCIIHexDecode/\n\t\t$attrib4 = /\\/ASCII85Decode/\n\n\t\t$action1 = \"Array\"\n\t\t$cond0 = \"unescape\"\n\t\t$nop = \"%u9090%u9090\"\n\tcondition:\n\t\t$magic in (0..1024) and (2 of ($attrib*)) or ($action1 and $cond0 and $nop)\n}\n\nrule shellcode_blob_metadata : PDF raw\n{\n        meta:\n                author = \"Glenn Edwards (@hiddenillusion)\"\n                version = \"0.1\"\n                description = \"When there's a large Base64 blob inserted into metadata fields it often indicates shellcode to later be decoded\"\n                weight = 4\n        strings:\n                $magic = { 25 50 44 46 }\n\n                $reg_keyword = /\\/Keywords.?\\(([a-zA-Z0-9]{200,})/ //~6k was observed in BHEHv2 PDF exploits holding the shellcode\n                $reg_author = /\\/Author.?\\(([a-zA-Z0-9]{200,})/\n                $reg_title = /\\/Title.?\\(([a-zA-Z0-9]{200,})/\n                $reg_producer = /\\/Producer.?\\(([a-zA-Z0-9]{200,})/\n                $reg_creator = /\\/Creator.?\\(([a-zA-Z0-9]{300,})/\n                $reg_create = /\\/CreationDate.?\\(([a-zA-Z0-9]{200,})/\n\n        condition:\n                $magic in (0..1024) and 1 of ($reg*)\n}\n\nrule suspicious_js : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 3\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\n\t\t$attrib0 = /\\/OpenAction /\n\t\t$attrib1 = /\\/JavaScript /\n\n\t\t$js0 = \"eval\"\n\t\t$js1 = \"Array\"\n\t\t$js2 = \"String.fromCharCode\"\n\n\tcondition:\n\t\t$magic in (0..1024) and all of ($attrib*) and 2 of ($js*)\n}\n\nrule suspicious_launch_action : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 2\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\n\t\t$attrib0 = /\\/Launch/\n\t\t$attrib1 = /\\/URL /\n\t\t$attrib2 = /\\/Action/\n\t\t$attrib3 = /\\/OpenAction/\n\t\t$attrib4 = /\\/F /\n\n\tcondition:\n\t\t$magic in (0..1024) and 3 of ($attrib*)\n}\n\nrule suspicious_embed : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tref = \"https://feliam.wordpress.com/2010/01/13/generic-pdf-exploit-hider-embedpdf-py-and-goodbye-av-detection-012010/\"\n\t\tweight = 2\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\n\t\t$meth0 = /\\/Launch/\n\t\t$meth1 = /\\/GoTo(E|R)/ //means go to embedded or remote\n\t\t$attrib0 = /\\/URL /\n\t\t$attrib1 = /\\/Action/\n\t\t$attrib2 = /\\/Filespec/\n\n\tcondition:\n\t\t$magic in (0..1024) and 1 of ($meth*) and 2 of ($attrib*)\n}\n\nrule invalid_XObject_js : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tdescription = \"XObject's require v1.4+\"\n\t\tref = \"https://blogs.adobe.com/ReferenceXObjects/\"\n\t\tversion = \"0.1\"\n\t\tweight = 2\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$ver = /%PDF-1\\.[4-9]/\n\n\t\t$attrib0 = /\\/XObject/\n\t\t$attrib1 = /\\/JavaScript/\n\n\tcondition:\n\t\t$magic in (0..1024) and not $ver and all of ($attrib*)\n}\n\n/* Not compatible with yara-x\nrule invalid_trailer_structure : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t// Required for a valid PDF\n                $reg0 = /trailer\\r?\\n?.{,8192}\\/Size.{,8192}\\r?\\n?/\n                $reg1 = /\\/Root.{,8192}\\r?\\n?.{,8192}startxref\\r?\\n?.{,8192}\\r?\\n?%%EOF/\n\n        condition:\n                $magic in (0..1024) and not $reg0 and not $reg1\n}\n*/\n\nrule multiple_versions : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n        description = \"Written very generically and doesn't hold any weight - just something that might be useful to know about to help show incremental updates to the file being analyzed\"\n\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n                $s0 = \"trailer\"\n                $s1 = \"%%EOF\"\n\n        condition:\n                $magic in (0..1024) and #s0 > 1 and #s1 > 1\n}\n\nrule js_wrong_version : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tdescription = \"JavaScript was introduced in v1.3\"\n\t\tref = \"http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/pdf/pdfs/pdf_reference_1-7.pdf\"\n\t\tversion = \"0.1\"\n\t\tweight = 2\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t\t\t$js = /\\/JavaScript/\n\t\t\t\t$ver = /%PDF-1\\.[3-9]/\n\n        condition:\n                $magic in (0..1024) and $js and not $ver\n}\n\nrule JBIG2_wrong_version : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tdescription = \"JBIG2 was introduced in v1.4\"\n\t\tref = \"http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/pdf/pdfs/pdf_reference_1-7.pdf\"\n\t\tversion = \"0.1\"\n\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t\t\t$js = /\\/JBIG2Decode/\n\t\t\t\t$ver = /%PDF-1\\.[4-9]/\n\n        condition:\n                $magic in (0..1024) and $js and not $ver\n}\n\nrule FlateDecode_wrong_version : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tdescription = \"Flate was introduced in v1.2\"\n\t\tref = \"http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/pdf/pdfs/pdf_reference_1-7.pdf\"\n\t\tversion = \"0.1\"\n\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t\t\t$js = /\\/FlateDecode/\n\t\t\t\t$ver = /%PDF-1\\.[2-9]/\n\n        condition:\n                $magic in (0..1024) and $js and not $ver\n}\n\nrule embed_wrong_version : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tdescription = \"EmbeddedFiles were introduced in v1.3\"\n\t\tref = \"http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/pdf/pdfs/pdf_reference_1-7.pdf\"\n\t\tversion = \"0.1\"\n\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t\t\t$embed = /\\/EmbeddedFiles/\n\t\t\t\t$ver = /%PDF-1\\.[3-9]/\n\n        condition:\n                $magic in (0..1024) and $embed and not $ver\n}\n\n/* Not compatible with yara-x\nrule invalid_xref_numbers : PDF raw\n{\n        meta:\n\t\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\t\tversion = \"0.1\"\n\t\t\tdescription = \"The first entry in a cross-reference table is always free and has a generation number of 65,535\"\n\t\t\tnotes = \"This can be also be in a stream...\"\n\t\t\tweight = 1\n\n        strings:\n                $magic = { 25 50 44 46 }\n                $reg0 = /xref\\r?\\n?.{,8192}\\r?\\n?.{,8192}65535\\sf/\n                $reg1 = /endstream.{,8192}\\r?\\n?endobj.{,8192}\\r?\\n?startxref/\n        condition:\n                $magic in (0..1024) and not $reg0 and not $reg1\n}\n*/\n\nrule js_splitting : PDF raw\n{\n        meta:\n                author = \"Glenn Edwards (@hiddenillusion)\"\n                version = \"0.1\"\n                description = \"These are commonly used to split up JS code\"\n                weight = 2\n\n        strings:\n                $magic = { 25 50 44 46 }\n\t\t\t\t$js = /\\/JavaScript/\n                $s0 = \"getAnnots\"\n                $s1 = \"getPageNumWords\"\n                $s2 = \"getPageNthWord\"\n                $s3 = \"this.info\"\n\n        condition:\n                $magic in (0..1024) and $js and 1 of ($s*)\n}\n\nrule header_evasion : PDF raw\n{\n        meta:\n                author = \"Glenn Edwards (@hiddenillusion)\"\n                description = \"3.4.1, 'File Header' of Appendix H states that ' Acrobat viewers require only that the header appear somewhere within the first 1024 bytes of the file.'  Therefore, if you see this trigger then any other rule looking to match the magic at 0 won't be applicable\"\n                ref = \"http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/pdf/pdfs/pdf_reference_1-7.pdf\"\n                version = \"0.1\"\n                weight = 3\n\n        strings:\n                $magic = { 25 50 44 46 }\n        condition:\n                $magic in (5..1024) and #magic == 1\n}\n\nrule BlackHole_v2 : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tref = \"http://fortknoxnetworks.blogspot.no/2012/10/blackhhole-exploit-kit-v-20-url-pattern.html\"\n\t\tweight = 3\n\n\tstrings:\n\t\t$magic = { 25 50 44 46 }\n\t\t$content = \"Index[5 1 7 1 9 4 23 4 50\"\n\n\tcondition:\n\t\t$magic in (0..1024) and $content\n}\n\n\nrule XDP_embedded_PDF : PDF raw\n{\n\tmeta:\n\t\tauthor = \"Glenn Edwards (@hiddenillusion)\"\n\t\tversion = \"0.1\"\n\t\tref = \"http://blog.9bplus.com/av-bypass-for-malicious-pdfs-using-xdp\"\n        weight = 1\n\n\tstrings:\n\t\t$s1 = \"<pdf xmlns=\"\n\t\t$s2 = \"<chunk>\"\n\t\t$s3 = \"</pdf>\"\n\t\t$header0 = \"%PDF\"\n\t\t$header1 = \"JVBERi0\"\n\n\tcondition:\n\t\tall of ($s*) and 1 of ($header*)\n}\n\nrule PDF_Embedded_Exe : PDF\n{\n\tmeta:\n\t\tref = \"https://github.com/jacobsoo/Yara-Rules/blob/master/PDF_Embedded_Exe.yar\"\n\tstrings:\n    \t$header = {25 50 44 46}\n    \t$Launch_Action = {3C 3C 2F 53 2F 4C 61 75 6E 63 68 2F 54 79 70 65 2F 41 63 74 69 6F 6E 2F 57 69 6E 3C 3C 2F 46}\n        $exe = {3C 3C 2F 45 6D 62 65 64 64 65 64 46 69 6C 65 73}\n    condition:\n    \t$header at 0 and $Launch_Action and $exe\n}\n",
    "uploadedBy": "f0b33c9c-0019-4046-984b-f6f3d95dea61",
    "category": "yar",
    "uploadedAt": "2025-05-07T09:54:43.605Z",
    "status": "active"
}